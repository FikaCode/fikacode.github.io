<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="keywords" content="Drinker Github Pages">
<meta name="description" content="玻璃晴朗，橘子辉煌">
<meta name="theme-color" content="#000">
<title>Drinker</title>
<link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/favicon.ico?v=1609811954338">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/styles/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/media/css/mist.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/media/fonts/font-awesome.css">
<link
  href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Rosario:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext"
  rel="stylesheet" type="text/css">

<link href="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/media/hljs/styles/androidstudio.css"
  rel="stylesheet">

<script src="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/media/hljs/highlight.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.0/velocity.ui.min.js"></script>

<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>



</head>

<body>
  <div class="head-top-line"></div>
  <div class="header-box">
    
<div class="mist">
  <header class="header bg-color ">
    <div class="blog-header box-shadow-wrapper  " id="header">
      <div class="nav-toggle" id="nav_toggle">
        <div class="toggle-box">
          <div class="line line-top"></div>
          <div class="line line-center"></div>
          <div class="line line-bottom"></div>
        </div>
      </div>
      <div class="site-meta">       
        <div class="site-title">
          
            <a href="/" class="">
              <span class="logo-line-before">
                <i class=""></i>
              </span>
              <span class="main-title">Drinker</span>
              <span class="logo-line-after">
                <i class=""></i>
              </span>
            </a>  
          
        </div>
        
      </div>
      <nav class="site-nav" id="site_nav">
        <ul id="nav_ul">
          
            
            
              
            
            <li class="nav-item nav-item-active">
              
              
                <a href="/" target="_self">
                  <i class="fa fa-home"></i> 首页
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/archives/" target="_self">
                  <i class="fa fa-archive"></i> 归档
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/tags/" target="_self">
                  <i class="fa fa-tags"></i> 标签
                </a>
              
            </li>
          
            
            
              
            
            <li class="nav-item ">
              
              
                <a href="/post/about/" target="_self">
                  <i class="fa fa-user"></i> 关于
                </a>
              
            </li>
          
          
            
              <li class="nav-item ">
                <a href="/friends/" target="_self">
                  
                    <i class="fa fa-address-book"></i> 友情链接
                  
                </a>
              </li>
            
          
        </ul>
      </nav>
    </div>
  </header>
</div>

<script type="text/javascript"> 
 
  let showNav = true;

  let navToggle = document.querySelector('#nav_toggle'),
  siteNav = document.querySelector('#site_nav');
  
  function navClick() {
    let sideBar = document.querySelector('.sidebar');
    let navUl = document.querySelector('#nav_ul');
    navToggle.classList.toggle('nav-toggle-active');
    siteNav.classList.toggle('nav-menu-active');
    if (siteNav.classList.contains('nav-menu-active')) {
      siteNav.style = "height: " + (navUl.children.length * 42) +"px !important";
    } else {
      siteNav.style = "";
    }
  }

  navToggle.addEventListener('click',navClick);  
</script>
  </div>
  <div class="main-continer">
    
    <div
      class="section-layout mist bg-color">
      <div class="section-layout-wrapper">
        <div id="sidebarMeta" class="sidebar">
    
<div class="sidebar-wrapper box-shadow-wrapper ">
  <div class="sidebar-item">
    <img class="site-author-image right-motion" src="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/images/avatar.png"/>
    <p class="site-author-name">Drinker</p>
    
  </div>
  <div class="sidebar-item side-item-stat right-motion">
    <div class="sidebar-item-box">
      <a href="/archives/">
        
        <span class="site-item-stat-count">6</span>
        <span class="site-item-stat-name">文章</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="">
        <span class="site-item-stat-count">7</span>
        <span class="site-item-stat-name">分类</span>
      </a>
    </div>
    <div class="sidebar-item-box">
      <a href="/tags/">
        <span class="site-item-stat-count">7</span>
        <span class="site-item-stat-name">标签</span>
      </a>
    </div>
  </div>
  
  
    <div class="sidebar-item sidebar-item-social">
      <div class="social-item">
        
          
            <a href="">
              <i class="fa fa-globe" title=""></i>
            </a>
          
        
        
      </div>
    </div>
  


</div>
</div>
<script>
  let sidebarMeta = document.querySelector('#sidebarMeta');
  let scheme = 'mist';
  let sidebarWrapper = document.querySelector('.sidebar-wrapper');
  if (sidebarMeta && (scheme === 'pisces' || scheme === 'gemini')) {
    document.addEventListener('scroll', function(e) {
      if (document.scrollingElement.scrollTop > parseInt(sidebarMeta.style.marginTop) + 10) {
        sidebarWrapper.classList.add('home-sidebar-fixed')
      } else {
        sidebarWrapper.classList.remove('home-sidebar-fixed')
      }
    });
  }
  </script>
        <div class="section-box mist">
          <section class="section bg-color posts-expand slide-down-in">
            
  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/springbootGetBean/">
      Spring Boot 在非spring控制的组件获取bean
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2021-01-04</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/spring boot/">
        <span>spring boot</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/Java/">
        <span>Java</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>1分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>123<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/springbootGetBean/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/springSecurityTokenLogin/">
      Spring Security 自定义权限实现 redis token 登陆验证
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2020-12-30</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/springSecurity/">
        <span>spring security</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/spring boot/">
        <span>spring boot</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/Java/">
        <span>Java</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>20分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>3619<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/springSecurityTokenLogin/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/excelForceEnableVba/">
      excel强制启用VBA
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2020-12-30</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/excel/">
        <span>excel</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/vba/">
        <span>vba</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>1分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>186<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/excelForceEnableVba/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/springbootPackageToWar/">
      spring boot 打包为外置 tomcat (war)
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2020-12-30</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/spring boot/">
        <span>spring boot</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/maven/">
        <span>maven</span>
      </a>、
      
      
      
      <a href="https://fikacode.github.io/tag/tomcat/">
        <span>tomcat</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>2分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>281<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/springbootPackageToWar/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/tomcatOptimizationAndCache/">
      tomcat 常用的优化
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2020-12-30</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/tomcat/">
        <span>tomcat</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>3分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>410<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/tomcatOptimizationAndCache/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>

  <article class="post-list-box  post box-shadow-wrapper">
    <div class="article-wrapper bg-color">
      <header class="post-header">
  <h1 class="post-title">
    <a class="post-title-link" href="https://fikacode.github.io/post/javaListAverage/">
      java 将数组均分为多个数组
    </a>
  </h1>
  <div class="post-meta">
    
    <span class="meta-item pc-show">
      <i class="fa fa-calendar-o"></i>
      <span>发布于</span>
      <span>2020-12-30</span>
      <span class="post-meta-divider pc-show">|</span>
    </span>
    
    <span class="meta-item">
      <i class="fa fa-folder-o"></i>
      <span class="pc-show">分类于</span>
      
      
      <a href="https://fikacode.github.io/tag/Java/">
        <span>Java</span>
      </a>
      
      
    </span>
    <span class="post-meta-divider">|</span>
    
    <span class="meta-item">
      <i class="fa fa-clock-o"></i>
      <span>3分钟</span>
    </span>
    <span class="meta-item">
      <span class="post-meta-divider">|</span>
      <i class="fa fa-file-word-o"></i>
      <span>467<span class="pc-show">字数</span></span>
    </span>
    
  </div>
</header>
      <div class="post-body">
        
        
          
        
        
        <div class="post-button text-center">
          <a class="btn" href="https://fikacode.github.io/post/javaListAverage/" rel="contents">
            阅读全文 »
          </a>
        </div>
        
      </div>
      
        <footer class="post-footer">
          <div class="post-eof"></div>
        </footer>
      
    </div>
  </article>
  
            
            
<div class="page bg-color">
  <ul class="pagination-ul">
    
    
      
        <li class="pagination-li pagination-active">
            <a href="/page/../">
              1
            </a>
        </li>
      
    
    
  </ul>
</div>
          </section>
        </div>
      </div>
    </div>
    <div class="footer-box">
  <footer class="footer">
    <div class="copyright">
    </div>
    <div class="poweredby">
      
    </div>
  </footer>
  
  
    <div class="drawer-box right" id="drawer_box">
      <span class="muse-line muse-line-first"></span>
      <span class="muse-line muse-line-middle"></span>
      <span class="muse-line muse-line-last"></span>
    </div>
  
  <div class="mist back-to-top" id="back_to_top">
    <i class="fa fa-arrow-up"></i>
    
  </div>
  
  
  
</div>
<script>

  let sideBarOpen = 'sidebar-open';
  let body = document.body;
  let back2Top = document.querySelector('#back_to_top'),
  back2TopText = document.querySelector('#back_to_top_text'),
  drawerBox = document.querySelector('#drawer_box'),
  rightSideBar = document.querySelector('.sidebar'),
  viewport = document.querySelector('body');

  function scrollAnimation(currentY, targetY) {
   
    let needScrollTop = targetY - currentY
    let _currentY = currentY
    setTimeout(() => {
      const dist = Math.ceil(needScrollTop / 10)
      _currentY += dist
      window.scrollTo(_currentY, currentY)
      if (needScrollTop > 10 || needScrollTop < -10) {
        scrollAnimation(_currentY, targetY)
      } else {
        window.scrollTo(_currentY, targetY)
      }
    }, 1)
  }

  back2Top.addEventListener("click", function(e) {
    scrollAnimation(document.scrollingElement.scrollTop, 0);
    e.stopPropagation();
    return false;
  });
  
  window.addEventListener('scroll', function(e) {
    let percent = document.scrollingElement.scrollTop / (document.scrollingElement.scrollHeight - document.scrollingElement.clientHeight) * 100;
    if (percent > 1 && !back2Top.classList.contains('back-top-active')) {
      back2Top.classList.add('back-top-active');
    }
    if (percent == 0) {
      back2Top.classList.remove('back-top-active');
    }
    if (back2TopText) {
      back2TopText.textContent = Math.floor(percent);
    }
  });

  
  let hasCacu = false;
  window.onresize = function() {
    if (window.width > 991) {
      calcuHeight();
    } else {
      hasCacu = false;
    }
  }

  function calcuHeight() {
    // 动态调整站点概览高度
    if (!hasCacu && back2Top.classList.contains('pisces') || back2Top.classList.contains('gemini')) {
      let sideBar = document.querySelector('.sidebar');
      let navUl = document.querySelector('#site_nav');
      sideBar.style = 'margin-top:' + (navUl.offsetHeight + navUl.offsetTop + 15) + 'px;';
      hasCacu = true;
    }
  }
  calcuHeight();
  
  let open = false, MOTION_TIME = 300, RIGHT_MOVE_DIS = '320px';

  if (drawerBox) {
    let rightMotions = document.querySelectorAll('.right-motion');
    let right = drawerBox.classList.contains('right');

    let transitionDir = right ? "transition.slideRightIn" : "transition.slideLeftIn";

    let openProp, closeProp;
    if (right) {
      openProp = {
        paddingRight: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingRight: '0px'
      };
    } else {
      openProp = {
        paddingLeft: RIGHT_MOVE_DIS 
      };
      closeProp = {
        paddingLeft: '0px'
      };
    }

    drawerBox.onclick = function() {
      open = !open;
      window.Velocity(rightSideBar, 'stop');
      window.Velocity(viewport, 'stop');
      window.Velocity(rightMotions, 'stop');
      if (open) {
        window.Velocity(rightSideBar, {
          width: RIGHT_MOVE_DIS
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, transitionDir,{ });
          }
        })
        window.Velocity(viewport, openProp,{
          duration: MOTION_TIME
        });
      } else {
        window.Velocity(rightSideBar, {
          width: '0px'
        }, {
          duration: MOTION_TIME,
          begin: function() {
            window.Velocity(rightMotions, {
              opacity: 0
            });
          }
        })
        window.Velocity(viewport, closeProp ,{
          duration: MOTION_TIME
        });
      }
      for (let i = 0; i < drawerBox.children.length; i++) {
        drawerBox.children[i].classList.toggle('muse-line');
      }
      drawerBox.classList.toggle(sideBarOpen);
    }
  }

  // 链接跳转
  let newWindow = 'false'
  if (newWindow === 'true') {
    let links = document.querySelectorAll('.post-body a')
    links.forEach(item => {
      if (!item.classList.contains('btn')) {
        item.setAttribute("target","_blank");
      }
    })
  }
  // 代码高亮
  hljs.initHighlightingOnLoad();

</script>
    <div class="light-box" id="light_box"></div>
<script>
  let imgs = document.querySelectorAll('.post-body img');
  let lightBox = document.querySelector('#light_box');
  lightBox.addEventListener('mousedown', (e) => {
    e.preventDefault()
  })
  lightBox.addEventListener('mousewheel', (e) => {
    e.preventDefault()
  })
  let width = window.innerWidth * 0.8;
  lightBox.onclick = () => {
    let img = lightBox.querySelector('img');
    lightBox.style = '';
    img && img.remove();
  }
  imgs.forEach(item => {
    item.onclick = function (e) {
      let lightImg = document.createElement('img');
      lightImg.src = this.src;
      lightBox.style = `height: 100%; opacity: 1; background-color: rgba(0, 0, 0, 0.5);cursor: zoom-out;`;
      lightImg.style = `width: ${width}px; border: 1px solid #fff; border-radius: 2px;`;
      lightImg.onclick = function () {
        lightBox.style = '';
        this.remove();
      }
      lightBox.append(lightImg);
    }
  })
</script>
  </div>
</body>
<input hidden id="copy" />
<script>
  //拿来主义(真香)^_^，Clipboard 实现摘自掘金 https://juejin.im/post/5aefeb6e6fb9a07aa43c20af
  window.Clipboard = (function (window, document, navigator) {
    var textArea,
      copy;

    // 判断是不是ios端
    function isOS() {
      return navigator.userAgent.match(/ipad|iphone/i);
    }
    //创建文本元素
    function createTextArea(text) {
      textArea = document.createElement('textArea');
      textArea.value = text;
      textArea.style.width = 0;
      textArea.style.height = 0;
      textArea.clientHeight = 0;
      textArea.clientWidth = 0;
      document.body.appendChild(textArea);
    }
    //选择内容
    function selectText() {
      var range,
        selection;

      if (isOS()) {
        range = document.createRange();
        range.selectNodeContents(textArea);
        selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textArea.setSelectionRange(0, 999999);
      } else {
        textArea.select();
      }
    }

    //复制到剪贴板
    function copyToClipboard() {
      try {
        document.execCommand("Copy")
      } catch (err) {
        alert("复制错误！请手动复制！")
      }
      document.body.removeChild(textArea);
    }

    copy = function (text) {
      createTextArea(text);
      selectText();
      copyToClipboard();
    };

    return {
      copy: copy
    };
  })(window, document, navigator);

  function copyCode(e) {
    if (e.srcElement.tagName === 'SPAN' && e.srcElement.classList.contains('copy-code')) {
      let code = e.currentTarget.querySelector('code');
      var text = code.innerText;
      if (e.srcElement.textContent === '复制成功') {
        console.log('复制操作频率过高');
        return;
      }
      e.srcElement.textContent = '复制成功';
      (function (elem) {
        setTimeout(() => {
          if (elem.textContent === '复制成功') {
            elem.textContent = '复制代码'
          }
        }, 1000);
      })(e.srcElement)
      Clipboard.copy(text);
    }
  }

  let pres = document.querySelectorAll('pre');
  pres.forEach(pre => {
    let code = pre.querySelector('code');
    let copyElem = document.createElement('span');
    copyElem.classList.add('copy-code');
    copyElem.textContent = '复制代码';
    pre.appendChild(copyElem);
    pre.onclick = copyCode
  })
</script>
<script src="https://cdn.jsdelivr.net/gh/FikaCode/fikacode.github.io@master/media/js/motion.js"></script>

<script src="https://cdn.jsdelivr.net/gh/cferdinandi/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
<script>
  var scroll = new SmoothScroll('a[href*="#"]', {
    speed: 500
  });
</script>

<!-- <div class="search-mask" id="search_mask">
  <div class="search-box">
    <div class="search-title">
      <i class="fa fa-search"></i>
      <div class="input-box">
        <input type="text" placeholder="搜索">
      </div>
      <i class="fa fa-times-circle"></i>
    </div>
    <div class="result">
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/springbootGetBean/"" data-c="
          &lt;pre&gt;&lt;code&gt;/**
 * @ClassName SpringUtil
 * @Description Spring 工具类
 * @Author WFS
 * @Date 2019/4/3 11:03
 **/

@Component
public class SpringUtil implements ApplicationContextAware {

    private static ApplicationContext applicationContext;
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        if (SpringUtil.applicationContext == null) {
            SpringUtil.applicationContext = applicationContext;
        }
    }

    private static ApplicationContext getApplicationContext() {
        return applicationContext;
    }

    public static Object getBean(String name) {
        return getApplicationContext().getBean(name);
    }

    public static &amp;lt;T&amp;gt; T getBean(Class&amp;lt;T&amp;gt; clazz) {
        return getApplicationContext().getBean(clazz);
    }

    public static &amp;lt;T&amp;gt; T getBean(String name, Class&amp;lt;T&amp;gt; clazz) {
        return getApplicationContext().getBean(name, clazz);
    }

}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;需要注意几点&#34;&gt;需要注意几点&lt;/h4&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;SpringUtil&lt;/code&gt;需要被Spring Boot 扫描到&lt;/li&gt;
&lt;li&gt;使用的时机需要在&lt;code&gt;spring&lt;/code&gt;容器加载完所有Bean以后&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
">Spring Boot 在非spring控制的组件获取bean</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/springSecurityTokenLogin/"" data-c="
          &lt;h2 id=&#34;前言&#34;&gt;前言&lt;/h2&gt;
&lt;p&gt;  本文的实现方式主要针于与对&lt;code&gt;spring security&lt;/code&gt;有所了解的读者，通过增加&lt;code&gt;filter&lt;/code&gt;的方式，替换代替&lt;code&gt;spring security&lt;/code&gt;自带的的能登陆逻辑。&lt;/p&gt;
&lt;h2 id=&#34;准备工作&#34;&gt;准备工作&lt;/h2&gt;
&lt;h4 id=&#34;pom-配置&#34;&gt;pom 配置&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;    &amp;lt;parent&amp;gt;
        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
        &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;
        &amp;lt;version&amp;gt;2.2.2.RELEASE&amp;lt;/version&amp;gt;
    &amp;lt;/parent&amp;gt;

   &amp;lt;dependencies&amp;gt;
        &amp;lt;!-- spring security --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-security&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!-- redis --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;redis.clients&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;jedis&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;3.2.0&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!-- redis --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!-- JPA --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-data-jpa&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!-- 链接mysql --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;
        &amp;lt;/dependency&amp;gt;
        &amp;lt;!-- jwt --&amp;gt;
        &amp;lt;dependency&amp;gt;
            &amp;lt;groupId&amp;gt;com.auth0&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;java-jwt&amp;lt;/artifactId&amp;gt;
            &amp;lt;version&amp;gt;3.9.0&amp;lt;/version&amp;gt;
        &amp;lt;/dependency&amp;gt;
    &amp;lt;/dependencies&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;其他的pom配置这里不在贴出，有需要的可自行添加。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;redis-配置&#34;&gt;redis 配置&lt;/h4&gt;
&lt;p&gt;  RedisTemplate要来读取缓存在redis里面的token，登陆的时候需要使用到。这里为了以后扩展方便，使用RedisStandaloneConfiguration的方式配置RedisTemplate，可以自由配置端口和数据库。&lt;br&gt;
&lt;br/&gt;&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisStandaloneConfiguration;
import org.springframework.data.redis.connection.jedis.JedisClientConfiguration;
import org.springframework.data.redis.connection.jedis.JedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.core.StringRedisTemplate;
import org.springframework.data.redis.serializer.StringRedisSerializer;

import java.time.Duration;

/**
 * @ClassName SecurityRedisConfig
 * @Author WFS
 * @Date 2020/1/21 15:56
 */
@Configuration
public class SecurityRedisConfig {

    @Bean(&amp;quot;sysTokenRedisTemplate&amp;quot;)
    public RedisTemplate&amp;lt;String, String&amp;gt; getTokenRedisTemplate() {
        return buildRedisTemplateByDataBase(10);
    }

    private RedisTemplate&amp;lt;String, String&amp;gt; buildRedisTemplateByDataBase(Integer dataBase) {
        RedisTemplate&amp;lt;String, String&amp;gt; template = new StringRedisTemplate();
        RedisStandaloneConfiguration redisStandaloneConfiguration = new RedisStandaloneConfiguration();
        redisStandaloneConfiguration.setHostName(&amp;quot;localhost&amp;quot;);
        redisStandaloneConfiguration.setPort(6379);
        redisStandaloneConfiguration.setDatabase(dataBase);
        JedisClientConfiguration.JedisClientConfigurationBuilder clientConfiguration = JedisClientConfiguration.builder();
        clientConfiguration.connectTimeout(Duration.ofSeconds(60));
        JedisConnectionFactory codeFactory = new JedisConnectionFactory(redisStandaloneConfiguration,
                clientConfiguration.build());
        template.setConnectionFactory(codeFactory);
        template.setValueSerializer(new StringRedisSerializer());
        template.setKeySerializer(new StringRedisSerializer());
        template.setHashKeySerializer(new StringRedisSerializer());
        template.setHashValueSerializer(new StringRedisSerializer());
        template.afterPropertiesSet();
        return template;
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;跨域配置&#34;&gt;跨域配置&lt;/h4&gt;
&lt;p&gt;  一般使用token的都是前后端分离，跨域这个问题总是要解决。springboot框架自带跨域的filter的配置，但是那个配置有些时候老是会有问题，我建议自己配置filter的方式来增加跨域的支持。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import org.springframework.web.bind.annotation.RequestMethod;

import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

/**
 * @ClassName CROSFilter
 * @Author WFS
 * @Date 2020/2/7/0007 16:58
 */
public class CORSFilter implements Filter {
    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) servletRequest;
        HttpServletResponse response = (HttpServletResponse) servletResponse;
        String origin = request.getHeader(&amp;quot;Origin&amp;quot;);
        response.setHeader(&amp;quot;Access-Control-Allow-Origin&amp;quot;, origin);
        response.addHeader(&amp;quot;Access-Control-Allow-Methods&amp;quot;, &amp;quot;GET, POST, PUT, DELETE, OPTIONS&amp;quot;);
        response.addHeader(&amp;quot;Access-Control-Allow-Headers&amp;quot;,
                &amp;quot;Content-Type, Authorization&amp;quot;);
        response.addHeader(&amp;quot;Access-Control-Allow-Credentials&amp;quot;,
                &amp;quot;true&amp;quot;);
        if (RequestMethod.OPTIONS.toString().equals(request.getMethod())) {
            servletResponse.getWriter().println(&amp;quot;ok&amp;quot;);
            return;
        }
        filterChain.doFilter(request ,response);
    }

    @Override
    public void init(FilterConfig filterConfig) {

    }

    @Override
    public void destroy() {

    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;注册Filter&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;

import com.auth.frame.security.processor.CORSFilter;
import org.springframework.boot.web.servlet.FilterRegistrationBean;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

/**
 * @ClassName FilterConfig
 * @Author WFS
 * @Date 2020/2/7/0007 16:57
 */
@Configuration
public class FilterConfig {
    @Bean(name = &amp;quot;CORSFilter&amp;quot;)
    public FilterRegistrationBean&amp;lt;CORSFilter&amp;gt; setFilter() {
        FilterRegistrationBean&amp;lt;CORSFilter&amp;gt; filterBean = new FilterRegistrationBean&amp;lt;&amp;gt;();
        filterBean.setFilter(new CORSFilter());
        filterBean.setOrder(Integer.MIN_VALUE);
        filterBean.setName(&amp;quot;CORSFilter&amp;quot;);
        filterBean.addUrlPatterns(&amp;quot;/*&amp;quot;);
        return filterBean;
    }
}

&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;其余的选项可以按照自己的需求配置filter&lt;/li&gt;
&lt;li&gt;filterBean.setOrder(Integer.MIN_VALUE); 保证了filter 第一个执行。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;原理&#34;&gt;原理&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;h4 id=&#34;token-登陆&#34;&gt;token 登陆&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  spring security是由一大批filter组成，其中&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;是用户登陆验证时候的filter，我们要做的就是登陆验证之前检验token，如果token符合我们规则，那么从token里面取出授权信息，然后在&lt;code&gt;SecurityContextHolder&lt;/code&gt;里面增加授权信息。这样，后面经过&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;时就不会使用自带的登陆验证逻辑检验。如果token不符合规则，直接滤过，&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;检验没有授权信息，会引导到登陆页面。&lt;/p&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;自定义用户权限&#34;&gt;自定义用户权限&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  自定义用户权限主要用户来配合token做权限判断，从token里面取出来的授权信息就是关联我们的自定义权限。要实现自定义权限我们需要实现三个接口：&lt;code&gt;UserDetailsService&lt;/code&gt;，该接口主要获取用户对应的权限；&lt;code&gt;FilterInvocationSecurityMetadataSource&lt;/code&gt;启动项目时候所有url的权限信息；&lt;code&gt;AccessDecisionManager&lt;/code&gt;投票器，根据用户的权限信息和url权限信息来实现允许或者拒绝的逻辑。&lt;/p&gt;
&lt;h2 id=&#34;用户信息表&#34;&gt;用户信息表&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;h4 id=&#34;用户表&#34;&gt;用户表&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;


import com.auth.frame.common.BaseEntity;
import lombok.*;

import javax.persistence.*;
import java.util.Set;


@EqualsAndHashCode(callSuper = true)
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = &amp;quot;t_sys_user&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;), @Index(columnList = &amp;quot;phoneNum&amp;quot;)})
public class User extends BaseEntity {
    @Column(unique = true)
    private String phoneNum;
    @Column(unique = true)
    private String userName;
    @Column
    private String salt;
    @Column
    private String passWord;
    @Column
    private Boolean accountNonExpired;
    @Column
    private Boolean accountNonLocked;
    @Column
    private Boolean credentialsNonExpired;
    @Column
    private Boolean enabled;
    @ManyToMany(fetch = FetchType.EAGER)
    @JoinTable(name = &amp;quot;t_sys_user_role&amp;quot;, joinColumns = {@JoinColumn(name = &amp;quot;user_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)}
            , inverseJoinColumns = {@JoinColumn(name = &amp;quot;role_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)})
    private Set&amp;lt;Role&amp;gt; roles;

}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;角色表&#34;&gt;角色表&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;

import com.auth.frame.common.BaseEntity;
import lombok.*;

import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Index;
import javax.persistence.Table;

@EqualsAndHashCode(callSuper = true)
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = &amp;quot;t_sys_role&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;)})
public class Role extends BaseEntity {
    @Column
    private String name;
    @Column
    private String auth;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;url表&#34;&gt;URL表&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;


import com.auth.frame.common.BaseEntity;
import lombok.*;

import javax.persistence.*;
import java.util.Set;


@EqualsAndHashCode(callSuper = true)
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
@Entity
@Table(name = &amp;quot;t_sys_url&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;)})
public class URL extends BaseEntity {
    @Column
    private String name;
    @Column
    private String path;

    @ManyToMany (fetch = FetchType.EAGER)
    @JoinTable(name = &amp;quot;t_sys_url_role&amp;quot;, joinColumns = {@JoinColumn(name = &amp;quot;url_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)}
            , inverseJoinColumns = {@JoinColumn(name = &amp;quot;role_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)})
    private Set&amp;lt;Role&amp;gt; roles;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;BaseEntity 主要是提供主键和创建、修改时间的字段。&lt;/li&gt;
&lt;li&gt;注解中使用了 lombok。&lt;/li&gt;
&lt;li&gt;角色、用户和URL使用的是单边对应，如有需要可改为多边对应。&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;自定义认证&#34;&gt;自定义认证&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;h4 id=&#34;userdetails&#34;&gt;UserDetails&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  UserDetails是spring security中的用户信息接口，通过实现UserDetails可以和User表关联起来。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import com.auth.frame.security.bean.User;
import lombok.AllArgsConstructor;
import lombok.Data;
import lombok.NoArgsConstructor;
import org.springframework.security.core.GrantedAuthority;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;

import java.util.Collection;

/**
 * @ClassName CSTUserDetailService
 * @Author WFS
 * @Date 2020/1/21 10:39
 */
@NoArgsConstructor
@AllArgsConstructor
@Data
public class CSTUserDetails implements UserDetails {
    private Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities;
    private String username;
    private String userId;
    private Boolean accountNonExpired;
    private Boolean accountNonLocked;
    private Boolean credentialsNonExpired;
    private Boolean enabled;

    public CSTUserDetails(Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities, String username, String userId, boolean accountNonExpired, boolean accountNonLocked, boolean credentialsNonExpired, boolean enabled) {
        this.authorities = authorities;
        this.username = username;
        this.userId = userId;
        this.accountNonExpired = accountNonExpired;
        this.accountNonLocked = accountNonLocked;
        this.credentialsNonExpired = credentialsNonExpired;
        this.enabled = enabled;
    }

    public CSTUserDetails(User user) {
        this.authorities = CSTUserDetailsService.getAuthorities(user);
        this.username = user.getUserName();
        this.userId = user.getId();
        this.accountNonExpired = user.getAccountNonExpired();
        this.accountNonLocked = user.getAccountNonLocked();
        this.credentialsNonExpired = user.getCredentialsNonExpired();
        this.enabled = user.getEnabled();
    }


    @Override
    public Collection&amp;lt;? extends GrantedAuthority&amp;gt; getAuthorities() {
        return authorities;
    }

    @Override
    public String getPassword() {
        return null;
    }

    @Override
    public String getUsername() {
        return username;
    }

    @Override
    public boolean isAccountNonExpired() {
        return accountNonExpired;
    }

    @Override
    public boolean isAccountNonLocked() {
        return accountNonLocked;
    }

    @Override
    public boolean isCredentialsNonExpired() {
        return credentialsNonExpired;
    }

    @Override
    public boolean isEnabled() {
        return enabled;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;authorities&lt;/code&gt;是用户对应的权限，其实就是一个字符串列表，可以自行拓展。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;2&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;userdetailsservice&#34;&gt;UserDetailsService&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  UserDetailsService接口规定了通过用户名获取用户信息的接口，即获取UserDetails。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import com.auth.frame.security.bean.Role;
import com.auth.frame.security.bean.User;
import com.auth.frame.security.service.UserService;
import org.springframework.security.core.authority.SimpleGrantedAuthority;
import org.springframework.security.core.userdetails.UserDetails;
import org.springframework.security.core.userdetails.UserDetailsService;
import org.springframework.security.core.userdetails.UsernameNotFoundException;
import org.springframework.stereotype.Component;

import java.util.Collection;
import java.util.HashSet;
import java.util.Set;

/**
 * @ClassName CSTUserDetailsService
 * @Author WFS
 * @Date 2020/1/21 10:50
 */
@Component
public class CSTUserDetailsService implements UserDetailsService {


    private final UserService userService;

    public CSTUserDetailsService(UserService userService) {
        this.userService = userService;
    }

    @Override
    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {
        User user = userService.getCacheUser(s);
        if (user == null) {
            throw new UsernameNotFoundException(&amp;quot;User Not Find!&amp;quot;);
        } else {
            Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities = getAuthorities(user);
            return new CSTUserDetails(authorities, user.getUserName(), user.getId(), user.getAccountNonExpired(), user.getAccountNonLocked(), user.getCredentialsNonExpired(), user.getEnabled());
        }
    }

    public static Collection&amp;lt;SimpleGrantedAuthority&amp;gt; getAuthorities(User user) {
        Set&amp;lt;Role&amp;gt; roleSet = user.getRoles();
        Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities = new HashSet&amp;lt;&amp;gt;();
        if (roleSet != null &amp;amp;&amp;amp; !roleSet.isEmpty()) {
            roleSet.forEach(role -&amp;gt; authorities.add(new SimpleGrantedAuthority(role.getAuth())));
        }
        return authorities;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code&gt;loadUserByUsername&lt;/code&gt;函数中的参数&lt;code&gt;s&lt;/code&gt;即为用户名，&lt;code&gt;userService.getCacheUser&lt;/code&gt;的作用是根据用户名获取用户，此处使用的自己写的从缓存获取用户名，可以自由发挥，只要能构建&lt;code&gt;UserDetails&lt;/code&gt;即可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ol start=&#34;3&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;filterinvocationsecuritymetadatasource&#34;&gt;FilterInvocationSecurityMetadataSource&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  &lt;code&gt;FilterInvocationSecurityMetadataSource&lt;/code&gt;元数据，接口获取的是全部URL的权限信息和当http请求过来时候url对应的权限。其中&lt;code&gt;getAttributes&lt;/code&gt;的参数&lt;code&gt;o&lt;/code&gt;包含了当前访问的URL，根据URL我们需要返回对应的权限信息；&lt;code&gt;getAllConfigAttributes&lt;/code&gt;会在项目启动时执行一次，获取所有URL对应的权限信息。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import com.auth.frame.security.bean.Role;
import com.auth.frame.security.repository.RoleRepository;
import com.auth.frame.security.service.URLService;
import org.springframework.security.access.ConfigAttribute;
import org.springframework.security.access.SecurityConfig;
import org.springframework.security.web.FilterInvocation;
import org.springframework.security.web.access.intercept.FilterInvocationSecurityMetadataSource;

import java.util.Collection;
import java.util.HashSet;
import java.util.Set;

import static com.auth.frame.security.config.ConstValue.ROLE.DEFAULT_ROLE;

/**
 * @ClassName CSTSecurityMetadataSource
 * @Author WFS
 * @Date 2020/1/21 17:06
 */
public class CSTSecurityMetadataSource implements FilterInvocationSecurityMetadataSource {

    private URLService urlService;

    private RoleRepository roleRepository;

    public CSTSecurityMetadataSource(URLService urlService, RoleRepository roleRepository) {
        this.urlService = urlService;
        this.roleRepository = roleRepository;
    }

    @Override
    public Collection&amp;lt;ConfigAttribute&amp;gt; getAttributes(Object o) throws IllegalArgumentException {
        String url = ((FilterInvocation) o).getRequestUrl();
        Collection&amp;lt;ConfigAttribute&amp;gt; configAttributes = new HashSet&amp;lt;&amp;gt;();
        Set&amp;lt;Role&amp;gt; roles = urlService.getCacheURL(url);
        roles.forEach(ele -&amp;gt; configAttributes.add(new SecurityConfig(ele.getAuth())));
        if (configAttributes.isEmpty()) {
            configAttributes.add(new SecurityConfig(DEFAULT_ROLE));
        }
        return configAttributes;
    }

    @Override
    public Collection&amp;lt;ConfigAttribute&amp;gt; getAllConfigAttributes() {
        Collection&amp;lt;ConfigAttribute&amp;gt; configAttributes = new HashSet&amp;lt;&amp;gt;();
        roleRepository.findAllByDeletedIsFalse().forEach(e -&amp;gt; configAttributes.add(new SecurityConfig(e.getAuth())));
        return configAttributes;
    }

    @Override
    public boolean supports(Class&amp;lt;?&amp;gt; aClass) {
        return true;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start=&#34;4&#34;&gt;
&lt;li&gt;
&lt;h4 id=&#34;accessdecisionmanager&#34;&gt;AccessDecisionManager&lt;/h4&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;  投票管理器，接口规定了用户权限和URL权限之间的逻辑，即满足某种情况拒绝或者允许。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import org.springframework.security.access.AccessDecisionManager;
import org.springframework.security.access.AccessDeniedException;
import org.springframework.security.access.ConfigAttribute;
import org.springframework.security.authentication.InsufficientAuthenticationException;
import org.springframework.security.core.Authentication;

import java.util.Collection;

import static com.auth.frame.security.config.ConstValue.ROLE.DEFAULT_ROLE;

/**
 * @ClassName CSTAccessDecisionManager
 * @Author WFS
 * @Date 2020/1/21 17:06
 */
public class CSTAccessDecisionManager implements AccessDecisionManager {
    @Override
    public void decide(Authentication authentication, Object o, Collection&amp;lt;ConfigAttribute&amp;gt; collection) throws AccessDeniedException, InsufficientAuthenticationException {
        if (collection.size() == 1 &amp;amp;&amp;amp; collection.stream().anyMatch(ele -&amp;gt; DEFAULT_ROLE.equals(ele.getAttribute()))) {
            return;
        }
        if (!collection.stream().allMatch(ele -&amp;gt; authentication.getAuthorities().stream().anyMatch(e -&amp;gt; ele.getAttribute().equals(e.getAuthority())))) {
            throw new AccessDeniedException(&amp;quot;AccessDenied!&amp;quot;);
        }
    }

    @Override
    public boolean supports(ConfigAttribute configAttribute) {
        return Boolean.TRUE;
    }

    @Override
    public boolean supports(Class&amp;lt;?&amp;gt; aClass) {
        return Boolean.TRUE;
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;  &lt;code&gt;Authentication&lt;/code&gt;中包含有用户的权限信息，&lt;code&gt;Collection&amp;lt;ConfigAttribute&amp;gt;&lt;/code&gt;包含有当前URL需要的权限信息，根据这两个参数我们就可以自由的指定我们投票规则。比如：某个URL含有多个权限，某个用户只要拥有其中一个就可以访问，或者要求必须全部拥有对应的权限才可以访问，此处可以自由发挥。需要注意的是，&lt;strong&gt;&lt;code&gt;AccessDecisionManager&lt;/code&gt;不起作用的情况，原因是如果&lt;code&gt;Collection&amp;lt;ConfigAttribute&amp;gt;&lt;/code&gt;为&lt;code&gt;null&lt;/code&gt;或者&lt;code&gt;empty&lt;/code&gt;，则不会执行投票器，所以我们需要给没有配置权限的URL一个默认权限。&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&#34;tokenfilter&#34;&gt;tokenFilter&lt;/h2&gt;
&lt;p&gt;  tokenFilter主要用来检查是否登陆的逻辑。先从请求里面获取token，解密，然后从reids里面获取相关权限信息；如果没有token则检查是否是用户名和密码，如果存在那么验证用户名和密码是否匹配，然后生成授权信息，存入redis，返回token给前端。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;

import com.auth.frame.common.ResponseEntity;
import com.auth.frame.common.Utils.JSONUtil;
import com.auth.frame.common.Utils.StringUtil;
import com.auth.frame.security.Utils.TokenUtil;
import com.auth.frame.security.bean.User;
import com.auth.frame.security.repository.UserRepository;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.security.authentication.UsernamePasswordAuthenticationToken;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.stereotype.Component;
import org.springframework.util.DigestUtils;

import javax.annotation.Resource;
import javax.servlet.*;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;
import java.nio.charset.StandardCharsets;
import java.util.Set;
import java.util.UUID;
import java.util.concurrent.TimeUnit;

/**
 * @ClassName TokenFilter
 * @Author WFS
 * @Date 2020/1/21 10:47
 */
@Component
public class TokenFilter implements Filter {


    private final UserRepository userRepository;

    @Resource(name = &amp;quot;sysTokenRedisTemplate&amp;quot;)
    public RedisTemplate&amp;lt;String, String&amp;gt; redisTemplate;

    private static final String usernameParameter = &amp;quot;username&amp;quot;;
    private static final String passwordParameter = &amp;quot;password&amp;quot;;

    public TokenFilter(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    @Override
    public void init(FilterConfig filterConfig) {

    }

    @Override
    public void destroy() {

    }

    @Override
    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {
        HttpServletRequest request = (HttpServletRequest) servletRequest;
        HttpServletResponse response = (HttpServletResponse) servletResponse;
        String rds = TokenUtil.getBody(request);
        if (rds == null) {
            String username = request.getParameter(usernameParameter);
            String password = request.getParameter(passwordParameter);
            if (!StringUtil.isNullOrEmpty(username, password)) {
                User user = userRepository.findByDeletedIsFalseAndUserName(username);
                if (user != null) {
                    if (user.getAccountNonExpired() &amp;amp;&amp;amp; user.getAccountNonLocked() &amp;amp;&amp;amp; user.getCredentialsNonExpired() &amp;amp;&amp;amp; user.getEnabled()) {
                        if (!StringUtil.isNullOrEmpty(user.getSalt(), user.getPassWord())) {
                            if (user.getPassWord().equals(DigestUtils.md5DigestAsHex((password + user.getSalt()).getBytes(StandardCharsets.UTF_8)))) {
                                Set&amp;lt;String&amp;gt; rdsSet = redisTemplate.keys(&amp;quot;*&amp;quot;);
                                if (rdsSet != null) {
                                    for (String s : rdsSet) {
                                        String rc = redisTemplate.opsForValue().get(s);
                                        if (rc != null) {
                                            CSTUserDetails rc_u = JSONUtil.json2Obj(rc, CSTUserDetails.class);
                                            if (rc_u != null) {
                                                if (user.getId().equals(rc_u.getUserId())) {
                                                    redisTemplate.delete(s);
                                                }
                                            }
                                        }
                                    }
                                }
                                CSTUserDetails cstUserDetails = new CSTUserDetails(user);
                                String r = UUID.randomUUID().toString().replaceAll(&amp;quot;-&amp;quot;, &amp;quot;&amp;quot;);
                                redisTemplate.opsForValue().set(r, JSONUtil.obj2Json(cstUserDetails));
                                redisTemplate.expire(r, 2, TimeUnit.HOURS);
                                String token = TokenUtil.create(r);
                                ResponseEntity.ofToken(response, token);
                                return;
                            }
                        }
                    }
                }
            }
        } else {
            String cuStr = redisTemplate.opsForValue().get(rds);
            if (!StringUtil.isNullOrEmpty(cuStr)) {
                CSTUserDetails cu = JSONUtil.json2Obj(cuStr, CSTUserDetails.class);
                if (cu != null) {
                    if (cu.getAccountNonExpired() &amp;amp;&amp;amp; cu.getAccountNonLocked() &amp;amp;&amp;amp; cu.getCredentialsNonExpired() &amp;amp;&amp;amp; cu.getEnabled()) {
                        SecurityContextHolder.getContext().setAuthentication(new UsernamePasswordAuthenticationToken(cu.getUserId(), cu.getPassword(), cu.getAuthorities()));
                    }
                }
            }
        }
        filterChain.doFilter(servletRequest, servletResponse);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;TokenUtil&lt;/code&gt; 主要从&lt;code&gt;request&lt;/code&gt;里面解析&lt;code&gt;token&lt;/code&gt;里面的&lt;code&gt;rds&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;中间有一段&lt;code&gt;redis&lt;/code&gt;的操作，此处可以自行拓展，即每一个新的附带密码的请求都去删除&lt;code&gt;redis&lt;/code&gt;里面相同&lt;code&gt;userId&lt;/code&gt;的授权信息，这样做的好处是可以保证每个账号同一个时间只有一个人登陆。&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ResponseEntity.ofToken()&lt;/code&gt; 工具类，用于向&lt;code&gt;response&lt;/code&gt;返回信息&lt;/li&gt;
&lt;/ol&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;配置spring-security&#34;&gt;配置&lt;code&gt;spring security&lt;/code&gt;&lt;/h2&gt;
&lt;p&gt;  设置&lt;code&gt;withObjectPostProcessor&lt;/code&gt;来设置&lt;code&gt;AccessDecisionManager&lt;/code&gt;和&lt;code&gt;SecurityMetadataSource&lt;/code&gt;，&lt;code&gt;addFilterBefore&lt;/code&gt;设置&lt;code&gt;TokenFilter&lt;/code&gt;的位置，&lt;code&gt;web.ignoring&lt;/code&gt;设置开放&lt;code&gt;API&lt;/code&gt;的路径，开放&lt;code&gt;API&lt;/code&gt;不受&lt;code&gt;spring security&lt;/code&gt;过滤链的控制。&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;

import com.auth.frame.security.processor.CSTAccessDecisionManager;
import com.auth.frame.security.processor.CSTSecurityMetadataSource;
import com.auth.frame.security.processor.CSTUserDetailsService;
import com.auth.frame.security.processor.TokenFilter;
import com.auth.frame.security.repository.RoleRepository;
import com.auth.frame.security.service.URLService;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.ObjectPostProcessor;
import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;
import org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.builders.WebSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;
import org.springframework.security.config.http.SessionCreationPolicy;
import org.springframework.security.web.access.intercept.FilterSecurityInterceptor;
import org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;
import org.springframework.web.cors.CorsUtils;

/**
 * @ClassName SecurityConfig
 * @Author WFS
 * @Date 2020/1/21 10:25
 */
@Configuration
@EnableWebSecurity
@EnableGlobalMethodSecurity(jsr250Enabled = true)
public class SecurityConfig extends WebSecurityConfigurerAdapter {


    private final CSTUserDetailsService cstUserDetailsService;
    private final ApplicationSecurityConfig applicationSecurityConfig;
    private final TokenFilter tokenFilter;

    private final URLService urlService;
    private final RoleRepository roleRepository;


    public SecurityConfig(CSTUserDetailsService cstUserDetailsService, ApplicationSecurityConfig applicationSecurityConfig, TokenFilter tokenFilter, URLService urlService, RoleRepository roleRepository) {
        this.cstUserDetailsService = cstUserDetailsService;
        this.applicationSecurityConfig = applicationSecurityConfig;
        this.tokenFilter = tokenFilter;
        this.urlService = urlService;
        this.roleRepository = roleRepository;
    }

    @Override
    protected void configure(AuthenticationManagerBuilder auth) throws Exception {
        auth.userDetailsService(cstUserDetailsService);
    }

    @Bean
    public CSTAccessDecisionManager getCSTAccessDecisionManager() {
        return new CSTAccessDecisionManager();
    }

    @Bean
    public CSTSecurityMetadataSource getCSTSecurityMetadataSource() {
        return new CSTSecurityMetadataSource(urlService, roleRepository);
    }

    @Override
    protected void configure(HttpSecurity http) throws Exception {
        http.csrf().disable().cors()
                .and().authorizeRequests()
                .withObjectPostProcessor(new ObjectPostProcessor&amp;lt;FilterSecurityInterceptor&amp;gt;() {
                    @Override
                    public &amp;lt;O extends FilterSecurityInterceptor&amp;gt; O postProcess(O o) {
                        o.setAccessDecisionManager(getCSTAccessDecisionManager());
                        o.setSecurityMetadataSource(getCSTSecurityMetadataSource());
                        return o;
                    }
                })
                .requestMatchers(CorsUtils::isPreFlightRequest).permitAll()
                .anyRequest().authenticated()
                .and().anonymous().disable().formLogin().permitAll()
                .and().addFilterBefore(tokenFilter, UsernamePasswordAuthenticationFilter.class)
                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);
    }

    @Override
    public void configure(WebSecurity web) {
        web.ignoring().regexMatchers(applicationSecurityConfig.getOpenApi());
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;结语&#34;&gt;结语&lt;/h2&gt;
&lt;p&gt;  通过以上逻辑，token登陆和自定义权限功能已经完成，其实所有的功能实现集中于&lt;code&gt;UserDetails&lt;/code&gt;的构建和&lt;code&gt;AccessDecisionManager&lt;/code&gt;投票逻辑，熟知于此就可以随意拓展Filter来实现自己的功能。&lt;/p&gt;
">Spring Security 自定义权限实现 redis token 登陆验证</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/excelForceEnableVba/"" data-c="
          &lt;p&gt;事实上VBA的启用依赖于运行的容器，VBA本身没有强制启用的功能。但是我们可以用另外一种方法来实现 强制启用的功能：如果不启用那么，显示一个页面，提示启用；如果启用就隐藏提示，显示正文。&lt;br&gt;
大概代码如下：&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;Private Sub Workbook_BeforeClose(Cancel As Boolean)
    Dim sh AsWorksheet
    ForEach sht In Worksheets
        If sht.Name&amp;lt;&amp;gt;”Welcome”Then
           Sheets(sht.Name).Visible= False
        End If
    Next
    Sheets(“Welcome”).Visible= True
    Sheets(“Welcome”).Select
    ThisWorkbook.Save
End Sub
Private Sub Workbook_Open()
    Dim sht AsWorksheet
    ForEach sht In Worksheets
        If sht.Name&amp;lt;&amp;gt;”Welcome” Then
            sht.Visible = xlSheetVisible
        End If
    Next
    Worksheets(“Welcome”).Visible= xlSheetVeryHidden
    ThisWorkbook.Save
End Sub
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;代码很好理解：关闭之前，隐藏所有sheet，只显示Welcome；打开文件隐藏Welcome，显示正文。&lt;/p&gt;
">excel强制启用VBA</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/springbootPackageToWar/"" data-c="
          &lt;h2 id=&#34;修改pom文件&#34;&gt;修改pom文件&lt;/h2&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
    &amp;lt;!-- 移除嵌入式tomcat插件 --&amp;gt;
    &amp;lt;exclusions&amp;gt;
        &amp;lt;exclusion&amp;gt;
            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
            &amp;lt;artifactId&amp;gt;spring-boot-starter-tomcat&amp;lt;/artifactId&amp;gt;
        &amp;lt;/exclusion&amp;gt;
    &amp;lt;/exclusions&amp;gt;
&amp;lt;/dependency&amp;gt;

&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;javax.servlet-api&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;4.0.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;修改application启动类&#34;&gt;修改Application启动类&lt;/h2&gt;
&lt;h4 id=&#34;修改前&#34;&gt;修改前&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;public class Application {
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;修改后&#34;&gt;修改后&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;public class Application extends SpringBootServletInitializer {

    @Override
    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {
        return builder.sources(Application.class);
    }
    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id=&#34;特别注意&#34;&gt;特别注意&lt;/h2&gt;
&lt;h4 id=&#34;如果使用了-websocket那么需要注释掉下面的代码同时添加websocket的支持&#34;&gt;如果使用了 &lt;code&gt;websocket&lt;/code&gt;，那么需要注释掉下面的代码，同时添加&lt;code&gt;websocket&lt;/code&gt;的支持。&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;@Configuration
public class WebSocketConfig {
//    @Bean
//    public ServerEndpointExporter serverEndpointExporter() {
//        return new ServerEndpointExporter();
//    }
}
&lt;/code&gt;&lt;/pre&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&amp;gt;
&amp;lt;dependency&amp;gt;
    &amp;lt;groupId&amp;gt;javax.websocket&amp;lt;/groupId&amp;gt;
    &amp;lt;artifactId&amp;gt;javax.websocket-api&amp;lt;/artifactId&amp;gt;
    &amp;lt;version&amp;gt;1.1&amp;lt;/version&amp;gt;
    &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;
&amp;lt;/dependency&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;如果使用了注解webfilter那么需要使用filterregistrationbean的方式来注册filter&#34;&gt;如果使用了注解&lt;code&gt;@WebFilter&lt;/code&gt;，那么需要使用&lt;code&gt;FilterRegistrationBean&lt;/code&gt;的方式来注册&lt;code&gt;Filter&lt;/code&gt;。&lt;/h4&gt;
">spring boot 打包为外置 tomcat (war)</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/tomcatOptimizationAndCache/"" data-c="
          &lt;h4 id=&#34;catalina-设置-java-参数&#34;&gt;catalina 设置 java 参数&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;set CATALINA_OPTS=-Dfile.encoding=UTF-8 -server -Xms8192m -Xmx8192m -Xmn4096m -XX:SurvivorRatio=10 -XX:MaxTenuringThreshold=15 -XX:NewRatio=2 -XX:+DisableExplicitGC
&lt;/code&gt;&lt;/pre&gt;
&lt;blockquote&gt;
&lt;p&gt;根据环境的配置优化相关参数&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h4 id=&#34;serverxml-设置连接池&#34;&gt;Server.xml 设置连接池&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;    &amp;lt;Executor 
       name=&amp;quot;tomcatThreadPool&amp;quot; 
       namePrefix=&amp;quot;catalina-exec-&amp;quot;
       maxThreads=&amp;quot;500&amp;quot; 
       minSpareThreads=&amp;quot;100&amp;quot; 
       prestartminSpareThreads = &amp;quot;true&amp;quot;
       maxQueueSize = &amp;quot;100&amp;quot;
    /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;开启压缩和-nio2&#34;&gt;开启压缩和 NIO2&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;  &amp;lt;Connector 
    	executor=&amp;quot;tomcatThreadPool&amp;quot;
   	port=&amp;quot;80&amp;quot; 
   	protocol=&amp;quot;org.apache.coyote.http11.Http11Nio2Protocol&amp;quot; 
   	connectionTimeout=&amp;quot;20000&amp;quot; 
   	maxConnections=&amp;quot;10000&amp;quot; 
   	redirectPort=&amp;quot;8443&amp;quot; 
   	enableLookups=&amp;quot;false&amp;quot; 
   	acceptCount=&amp;quot;100&amp;quot; 
   	maxPostSize=&amp;quot;10485760&amp;quot; 
   	compression=&amp;quot;on&amp;quot; 
   	disableUploadTimeout=&amp;quot;true&amp;quot; 
   	compressionMinSize=&amp;quot;50&amp;quot; 
   	acceptorThreadCount=&amp;quot;4&amp;quot; 
   	compressableMimeType=&amp;quot;text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/x-javascript,application/json,image/jpg,application/x-font-ttf,application/x-font-otf,image/svg+xml,image/jpeg,image/png,image/gif,audio/mpeg,video/mp4,font/woff&amp;quot; 
   	URIEncoding=&amp;quot;utf-8&amp;quot;
     /&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;webxml-设置缓存&#34;&gt;web.xml 设置缓存&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;filter&amp;gt;
 &amp;lt;filter-name&amp;gt;ExpiresFilter&amp;lt;/filter-name&amp;gt;
 &amp;lt;filter-class&amp;gt;org.apache.catalina.filters.ExpiresFilter&amp;lt;/filter-class&amp;gt;
 &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;ExpiresByType image&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
 &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;ExpiresByType text&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
 &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;ExpiresByType application/javascript&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
 &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;ExpiresByType multipart/form-data&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
 &amp;lt;init-param&amp;gt;
    &amp;lt;param-name&amp;gt;ExpiresByType font/woff&amp;lt;/param-name&amp;gt;
    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;
 &amp;lt;/init-param&amp;gt;
&amp;lt;/filter&amp;gt;

&amp;lt;filter-mapping&amp;gt;
 &amp;lt;filter-name&amp;gt;ExpiresFilter&amp;lt;/filter-name&amp;gt;
 &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;
 &amp;lt;dispatcher&amp;gt;REQUEST&amp;lt;/dispatcher&amp;gt;
&amp;lt;/filter-mapping&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
">tomcat 常用的优化</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/about/"" data-c="
          &lt;blockquote&gt;
&lt;p&gt;欢迎来到我的Github Pages呀，很高兴遇见你！🤝&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;博主是谁&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;一个快奔三的Java 后端工程师&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;兴趣爱好&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;代码算不算？╮(╯▽╰)╭&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&#34;联系我呀&#34;&gt;📬 联系我呀&lt;/h2&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;a href=&#34;https://github.com/FikaCode&#34;&gt;https://github.com/FikaCode&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
">关于</a>
      </div>
      
      <div class="item">
        <a class="result-title" href="https://fikacode.github.io/post/javaListAverage/"" data-c="
          &lt;h4 id=&#34;将一组数据平均分成n组&#34;&gt;将一组数据平均分成n组&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/**
 * 将一组数据平均分成n组
 *
 * @param source 要分组的数据源
 * @param n      平均分成n组
 * @param &amp;lt;T&amp;gt;
 * @return
 */
public static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; averageAssign(List&amp;lt;T&amp;gt; source, int n) {
    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();
    int remainder = source.size() % n;  //(先计算出余数)
    int number = source.size() / n;  //然后是商
    int offset = 0;//偏移量
    for (int i = 0; i &amp;lt; n; i++) {
        List&amp;lt;T&amp;gt; value = null;
        if (remainder &amp;gt; 0) {
            value = source.subList(i * number + offset, (i + 1) * number + offset + 1);
            remainder--;
            offset++;
        } else {
            value = source.subList(i * number + offset, (i + 1) * number + offset);
        }
        result.add(value);
    }
    return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;将一组数据固定分组每组n个元素&#34;&gt;将一组数据固定分组，每组n个元素&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/**
 * 将一组数据固定分组，每组n个元素
 * @param source 要分组的数据源
 * @param n      每组n个元素
 * @param &amp;lt;T&amp;gt;
 * @return
 */
public static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; fixedGrouping(List&amp;lt;T&amp;gt; source, int n) {

    if (null == source || source.size() == 0 || n &amp;lt;= 0)
        return null;
    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();

    int sourceSize = source.size();
    int size = (source.size() / n) + 1;
    for (int i = 0; i &amp;lt; size; i++) {
        List&amp;lt;T&amp;gt; subset = new ArrayList&amp;lt;T&amp;gt;();
        for (int j = i * n; j &amp;lt; (i + 1) * n; j++) {
            if (j &amp;lt; sourceSize) {
                subset.add(source.get(j));
            }
        }
        result.add(subset);
    }
    return result;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id=&#34;将一组数据固定分组每组n个元素-2&#34;&gt;将一组数据固定分组，每组n个元素&lt;/h4&gt;
&lt;pre&gt;&lt;code&gt;/**
 * 将一组数据固定分组，每组n个元素，第二种写法
 *
 * @param source 要分组的数据源
 * @param n      每组n个元素
 * @param &amp;lt;T&amp;gt;
 * @return
 */
public static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; fixedGrouping2(List&amp;lt;T&amp;gt; source, int n) {

    if (null == source || source.size() == 0 || n &amp;lt;= 0)
        return null;
    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();
    int remainder = source.size() % n;
    int size = (source.size() / n);
    for (int i = 0; i &amp;lt; size; i++) {
        List&amp;lt;T&amp;gt; subset = null;
        subset = source.subList(i * n, (i + 1) * n);
        result.add(subset);
    }
    if (remainder &amp;gt; 0) {
        List&amp;lt;T&amp;gt; subset = null;
        subset = source.subList(size * n, size * n + remainder);
        result.add(subset);
    }
    return result;
}
&lt;/code&gt;&lt;/pre&gt;
">java 将数组均分为多个数组</a>
      </div>
      
    </div>
  </div>
</div>
<script>
  // var escape = "[{&#34;content&#34;:&#34;&lt;pre&gt;&lt;code&gt;/**\n * @ClassName SpringUtil\n * @Description Spring 工具类\n * @Author WFS\n * @Date 2019/4/3 11:03\n **/\n\n@Component\npublic class SpringUtil implements ApplicationContextAware {\n\n    private static ApplicationContext applicationContext;\n    @Override\n    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {\n        if (SpringUtil.applicationContext == null) {\n            SpringUtil.applicationContext = applicationContext;\n        }\n    }\n\n    private static ApplicationContext getApplicationContext() {\n        return applicationContext;\n    }\n\n    public static Object getBean(String name) {\n        return getApplicationContext().getBean(name);\n    }\n\n    public static &amp;lt;T&amp;gt; T getBean(Class&amp;lt;T&amp;gt; clazz) {\n        return getApplicationContext().getBean(clazz);\n    }\n\n    public static &amp;lt;T&amp;gt; T getBean(String name, Class&amp;lt;T&amp;gt; clazz) {\n        return getApplicationContext().getBean(name, clazz);\n    }\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;需要注意几点\&#34;&gt;需要注意几点&lt;/h4&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;SpringUtil&lt;/code&gt;需要被Spring Boot 扫描到&lt;/li&gt;\n&lt;li&gt;使用的时机需要在&lt;code&gt;spring&lt;/code&gt;容器加载完所有Bean以后&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;springbootGetBean&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Spring Boot 在非spring控制的组件获取bean&#34;,&#34;tags&#34;:[{&#34;index&#34;:2,&#34;name&#34;:&#34;spring boot&#34;,&#34;slug&#34;:&#34;spring boot&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/spring boot/&#34;},{&#34;index&#34;:-1,&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;Java&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/Java/&#34;}],&#34;date&#34;:&#34;2021-01-04 11:33:37&#34;,&#34;dateFormat&#34;:&#34;2021-01-04&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/springbootGetBean/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:40000,&#34;words&#34;:123,&#34;minutes&#34;:1},&#34;description&#34;:&#34;/**\n * @ClassName SpringUtil\n * @Description Spring 工具类\n * @Author WFS\n * @Date 2019/4/3 11:03\n **/\n\n@Component\npublic c...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%9C%80%E8%A6%81%E6%B3%A8%E6%84%8F%E5%87%A0%E7%82%B9\&#34;&gt;需要注意几点&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;前言\&#34;&gt;前言&lt;/h2&gt;\n&lt;p&gt;  本文的实现方式主要针于与对&lt;code&gt;spring security&lt;/code&gt;有所了解的读者，通过增加&lt;code&gt;filter&lt;/code&gt;的方式，替换代替&lt;code&gt;spring security&lt;/code&gt;自带的的能登陆逻辑。&lt;/p&gt;\n&lt;h2 id=\&#34;准备工作\&#34;&gt;准备工作&lt;/h2&gt;\n&lt;h4 id=\&#34;pom-配置\&#34;&gt;pom 配置&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;    &amp;lt;parent&amp;gt;\n        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n        &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;\n        &amp;lt;version&amp;gt;2.2.2.RELEASE&amp;lt;/version&amp;gt;\n    &amp;lt;/parent&amp;gt;\n\n   &amp;lt;dependencies&amp;gt;\n        &amp;lt;!-- spring security --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;spring-boot-starter-security&amp;lt;/artifactId&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n        &amp;lt;!-- redis --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;redis.clients&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;jedis&amp;lt;/artifactId&amp;gt;\n            &amp;lt;version&amp;gt;3.2.0&amp;lt;/version&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n        &amp;lt;!-- redis --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;spring-boot-starter-data-redis&amp;lt;/artifactId&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n        &amp;lt;!-- JPA --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;spring-boot-starter-data-jpa&amp;lt;/artifactId&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n        &amp;lt;!-- 链接mysql --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;mysql&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;mysql-connector-java&amp;lt;/artifactId&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n        &amp;lt;!-- jwt --&amp;gt;\n        &amp;lt;dependency&amp;gt;\n            &amp;lt;groupId&amp;gt;com.auth0&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;java-jwt&amp;lt;/artifactId&amp;gt;\n            &amp;lt;version&amp;gt;3.9.0&amp;lt;/version&amp;gt;\n        &amp;lt;/dependency&amp;gt;\n    &amp;lt;/dependencies&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;其他的pom配置这里不在贴出，有需要的可自行添加。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;redis-配置\&#34;&gt;redis 配置&lt;/h4&gt;\n&lt;p&gt;  RedisTemplate要来读取缓存在redis里面的token，登陆的时候需要使用到。这里为了以后扩展方便，使用RedisStandaloneConfiguration的方式配置RedisTemplate，可以自由配置端口和数据库。&lt;br&gt;\n&lt;br/&gt;&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;\n\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.data.redis.connection.RedisStandaloneConfiguration;\nimport org.springframework.data.redis.connection.jedis.JedisClientConfiguration;\nimport org.springframework.data.redis.connection.jedis.JedisConnectionFactory;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.data.redis.core.StringRedisTemplate;\nimport org.springframework.data.redis.serializer.StringRedisSerializer;\n\nimport java.time.Duration;\n\n/**\n * @ClassName SecurityRedisConfig\n * @Author WFS\n * @Date 2020/1/21 15:56\n */\n@Configuration\npublic class SecurityRedisConfig {\n\n    @Bean(&amp;quot;sysTokenRedisTemplate&amp;quot;)\n    public RedisTemplate&amp;lt;String, String&amp;gt; getTokenRedisTemplate() {\n        return buildRedisTemplateByDataBase(10);\n    }\n\n    private RedisTemplate&amp;lt;String, String&amp;gt; buildRedisTemplateByDataBase(Integer dataBase) {\n        RedisTemplate&amp;lt;String, String&amp;gt; template = new StringRedisTemplate();\n        RedisStandaloneConfiguration redisStandaloneConfiguration = new RedisStandaloneConfiguration();\n        redisStandaloneConfiguration.setHostName(&amp;quot;localhost&amp;quot;);\n        redisStandaloneConfiguration.setPort(6379);\n        redisStandaloneConfiguration.setDatabase(dataBase);\n        JedisClientConfiguration.JedisClientConfigurationBuilder clientConfiguration = JedisClientConfiguration.builder();\n        clientConfiguration.connectTimeout(Duration.ofSeconds(60));\n        JedisConnectionFactory codeFactory = new JedisConnectionFactory(redisStandaloneConfiguration,\n                clientConfiguration.build());\n        template.setConnectionFactory(codeFactory);\n        template.setValueSerializer(new StringRedisSerializer());\n        template.setKeySerializer(new StringRedisSerializer());\n        template.setHashKeySerializer(new StringRedisSerializer());\n        template.setHashValueSerializer(new StringRedisSerializer());\n        template.afterPropertiesSet();\n        return template;\n    }\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;跨域配置\&#34;&gt;跨域配置&lt;/h4&gt;\n&lt;p&gt;  一般使用token的都是前后端分离，跨域这个问题总是要解决。springboot框架自带跨域的filter的配置，但是那个配置有些时候老是会有问题，我建议自己配置filter的方式来增加跨域的支持。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport org.springframework.web.bind.annotation.RequestMethod;\n\nimport javax.servlet.*;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\n\n/**\n * @ClassName CROSFilter\n * @Author WFS\n * @Date 2020/2/7/0007 16:58\n */\npublic class CORSFilter implements Filter {\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        HttpServletRequest request = (HttpServletRequest) servletRequest;\n        HttpServletResponse response = (HttpServletResponse) servletResponse;\n        String origin = request.getHeader(&amp;quot;Origin&amp;quot;);\n        response.setHeader(&amp;quot;Access-Control-Allow-Origin&amp;quot;, origin);\n        response.addHeader(&amp;quot;Access-Control-Allow-Methods&amp;quot;, &amp;quot;GET, POST, PUT, DELETE, OPTIONS&amp;quot;);\n        response.addHeader(&amp;quot;Access-Control-Allow-Headers&amp;quot;,\n                &amp;quot;Content-Type, Authorization&amp;quot;);\n        response.addHeader(&amp;quot;Access-Control-Allow-Credentials&amp;quot;,\n                &amp;quot;true&amp;quot;);\n        if (RequestMethod.OPTIONS.toString().equals(request.getMethod())) {\n            servletResponse.getWriter().println(&amp;quot;ok&amp;quot;);\n            return;\n        }\n        filterChain.doFilter(request ,response);\n    }\n\n    @Override\n    public void init(FilterConfig filterConfig) {\n\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;注册Filter&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;\n\nimport com.auth.frame.security.processor.CORSFilter;\nimport org.springframework.boot.web.servlet.FilterRegistrationBean;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\n\n/**\n * @ClassName FilterConfig\n * @Author WFS\n * @Date 2020/2/7/0007 16:57\n */\n@Configuration\npublic class FilterConfig {\n    @Bean(name = &amp;quot;CORSFilter&amp;quot;)\n    public FilterRegistrationBean&amp;lt;CORSFilter&amp;gt; setFilter() {\n        FilterRegistrationBean&amp;lt;CORSFilter&amp;gt; filterBean = new FilterRegistrationBean&amp;lt;&amp;gt;();\n        filterBean.setFilter(new CORSFilter());\n        filterBean.setOrder(Integer.MIN_VALUE);\n        filterBean.setName(&amp;quot;CORSFilter&amp;quot;);\n        filterBean.addUrlPatterns(&amp;quot;/*&amp;quot;);\n        return filterBean;\n    }\n}\n\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;其余的选项可以按照自己的需求配置filter&lt;/li&gt;\n&lt;li&gt;filterBean.setOrder(Integer.MIN_VALUE); 保证了filter 第一个执行。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;原理\&#34;&gt;原理&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;token-登陆\&#34;&gt;token 登陆&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  spring security是由一大批filter组成，其中&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;是用户登陆验证时候的filter，我们要做的就是登陆验证之前检验token，如果token符合我们规则，那么从token里面取出授权信息，然后在&lt;code&gt;SecurityContextHolder&lt;/code&gt;里面增加授权信息。这样，后面经过&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;时就不会使用自带的登陆验证逻辑检验。如果token不符合规则，直接滤过，&lt;code&gt;UsernamePasswordAuthenticationFilter&lt;/code&gt;检验没有授权信息，会引导到登陆页面。&lt;/p&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;自定义用户权限\&#34;&gt;自定义用户权限&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  自定义用户权限主要用户来配合token做权限判断，从token里面取出来的授权信息就是关联我们的自定义权限。要实现自定义权限我们需要实现三个接口：&lt;code&gt;UserDetailsService&lt;/code&gt;，该接口主要获取用户对应的权限；&lt;code&gt;FilterInvocationSecurityMetadataSource&lt;/code&gt;启动项目时候所有url的权限信息；&lt;code&gt;AccessDecisionManager&lt;/code&gt;投票器，根据用户的权限信息和url权限信息来实现允许或者拒绝的逻辑。&lt;/p&gt;\n&lt;h2 id=\&#34;用户信息表\&#34;&gt;用户信息表&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;用户表\&#34;&gt;用户表&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;\n\n\nimport com.auth.frame.common.BaseEntity;\nimport lombok.*;\n\nimport javax.persistence.*;\nimport java.util.Set;\n\n\n@EqualsAndHashCode(callSuper = true)\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\n@Entity\n@Table(name = &amp;quot;t_sys_user&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;), @Index(columnList = &amp;quot;phoneNum&amp;quot;)})\npublic class User extends BaseEntity {\n    @Column(unique = true)\n    private String phoneNum;\n    @Column(unique = true)\n    private String userName;\n    @Column\n    private String salt;\n    @Column\n    private String passWord;\n    @Column\n    private Boolean accountNonExpired;\n    @Column\n    private Boolean accountNonLocked;\n    @Column\n    private Boolean credentialsNonExpired;\n    @Column\n    private Boolean enabled;\n    @ManyToMany(fetch = FetchType.EAGER)\n    @JoinTable(name = &amp;quot;t_sys_user_role&amp;quot;, joinColumns = {@JoinColumn(name = &amp;quot;user_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)}\n            , inverseJoinColumns = {@JoinColumn(name = &amp;quot;role_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)})\n    private Set&amp;lt;Role&amp;gt; roles;\n\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;角色表\&#34;&gt;角色表&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;\n\nimport com.auth.frame.common.BaseEntity;\nimport lombok.*;\n\nimport javax.persistence.Column;\nimport javax.persistence.Entity;\nimport javax.persistence.Index;\nimport javax.persistence.Table;\n\n@EqualsAndHashCode(callSuper = true)\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\n@Entity\n@Table(name = &amp;quot;t_sys_role&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;)})\npublic class Role extends BaseEntity {\n    @Column\n    private String name;\n    @Column\n    private String auth;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;url表\&#34;&gt;URL表&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.bean;\n\n\nimport com.auth.frame.common.BaseEntity;\nimport lombok.*;\n\nimport javax.persistence.*;\nimport java.util.Set;\n\n\n@EqualsAndHashCode(callSuper = true)\n@Data\n@Builder\n@NoArgsConstructor\n@AllArgsConstructor\n@Entity\n@Table(name = &amp;quot;t_sys_url&amp;quot;, indexes = {@Index(columnList = &amp;quot;id&amp;quot;)})\npublic class URL extends BaseEntity {\n    @Column\n    private String name;\n    @Column\n    private String path;\n\n    @ManyToMany (fetch = FetchType.EAGER)\n    @JoinTable(name = &amp;quot;t_sys_url_role&amp;quot;, joinColumns = {@JoinColumn(name = &amp;quot;url_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)}\n            , inverseJoinColumns = {@JoinColumn(name = &amp;quot;role_id&amp;quot;, referencedColumnName = &amp;quot;id&amp;quot;)})\n    private Set&amp;lt;Role&amp;gt; roles;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;BaseEntity 主要是提供主键和创建、修改时间的字段。&lt;/li&gt;\n&lt;li&gt;注解中使用了 lombok。&lt;/li&gt;\n&lt;li&gt;角色、用户和URL使用的是单边对应，如有需要可改为多边对应。&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;自定义认证\&#34;&gt;自定义认证&lt;/h2&gt;\n&lt;ol&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;userdetails\&#34;&gt;UserDetails&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  UserDetails是spring security中的用户信息接口，通过实现UserDetails可以和User表关联起来。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport com.auth.frame.security.bean.User;\nimport lombok.AllArgsConstructor;\nimport lombok.Data;\nimport lombok.NoArgsConstructor;\nimport org.springframework.security.core.GrantedAuthority;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\n\nimport java.util.Collection;\n\n/**\n * @ClassName CSTUserDetailService\n * @Author WFS\n * @Date 2020/1/21 10:39\n */\n@NoArgsConstructor\n@AllArgsConstructor\n@Data\npublic class CSTUserDetails implements UserDetails {\n    private Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities;\n    private String username;\n    private String userId;\n    private Boolean accountNonExpired;\n    private Boolean accountNonLocked;\n    private Boolean credentialsNonExpired;\n    private Boolean enabled;\n\n    public CSTUserDetails(Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities, String username, String userId, boolean accountNonExpired, boolean accountNonLocked, boolean credentialsNonExpired, boolean enabled) {\n        this.authorities = authorities;\n        this.username = username;\n        this.userId = userId;\n        this.accountNonExpired = accountNonExpired;\n        this.accountNonLocked = accountNonLocked;\n        this.credentialsNonExpired = credentialsNonExpired;\n        this.enabled = enabled;\n    }\n\n    public CSTUserDetails(User user) {\n        this.authorities = CSTUserDetailsService.getAuthorities(user);\n        this.username = user.getUserName();\n        this.userId = user.getId();\n        this.accountNonExpired = user.getAccountNonExpired();\n        this.accountNonLocked = user.getAccountNonLocked();\n        this.credentialsNonExpired = user.getCredentialsNonExpired();\n        this.enabled = user.getEnabled();\n    }\n\n\n    @Override\n    public Collection&amp;lt;? extends GrantedAuthority&amp;gt; getAuthorities() {\n        return authorities;\n    }\n\n    @Override\n    public String getPassword() {\n        return null;\n    }\n\n    @Override\n    public String getUsername() {\n        return username;\n    }\n\n    @Override\n    public boolean isAccountNonExpired() {\n        return accountNonExpired;\n    }\n\n    @Override\n    public boolean isAccountNonLocked() {\n        return accountNonLocked;\n    }\n\n    @Override\n    public boolean isCredentialsNonExpired() {\n        return credentialsNonExpired;\n    }\n\n    @Override\n    public boolean isEnabled() {\n        return enabled;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;code&gt;authorities&lt;/code&gt;是用户对应的权限，其实就是一个字符串列表，可以自行拓展。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol start=\&#34;2\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;userdetailsservice\&#34;&gt;UserDetailsService&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  UserDetailsService接口规定了通过用户名获取用户信息的接口，即获取UserDetails。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport com.auth.frame.security.bean.Role;\nimport com.auth.frame.security.bean.User;\nimport com.auth.frame.security.service.UserService;\nimport org.springframework.security.core.authority.SimpleGrantedAuthority;\nimport org.springframework.security.core.userdetails.UserDetails;\nimport org.springframework.security.core.userdetails.UserDetailsService;\nimport org.springframework.security.core.userdetails.UsernameNotFoundException;\nimport org.springframework.stereotype.Component;\n\nimport java.util.Collection;\nimport java.util.HashSet;\nimport java.util.Set;\n\n/**\n * @ClassName CSTUserDetailsService\n * @Author WFS\n * @Date 2020/1/21 10:50\n */\n@Component\npublic class CSTUserDetailsService implements UserDetailsService {\n\n\n    private final UserService userService;\n\n    public CSTUserDetailsService(UserService userService) {\n        this.userService = userService;\n    }\n\n    @Override\n    public UserDetails loadUserByUsername(String s) throws UsernameNotFoundException {\n        User user = userService.getCacheUser(s);\n        if (user == null) {\n            throw new UsernameNotFoundException(&amp;quot;User Not Find!&amp;quot;);\n        } else {\n            Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities = getAuthorities(user);\n            return new CSTUserDetails(authorities, user.getUserName(), user.getId(), user.getAccountNonExpired(), user.getAccountNonLocked(), user.getCredentialsNonExpired(), user.getEnabled());\n        }\n    }\n\n    public static Collection&amp;lt;SimpleGrantedAuthority&amp;gt; getAuthorities(User user) {\n        Set&amp;lt;Role&amp;gt; roleSet = user.getRoles();\n        Collection&amp;lt;SimpleGrantedAuthority&amp;gt; authorities = new HashSet&amp;lt;&amp;gt;();\n        if (roleSet != null &amp;amp;&amp;amp; !roleSet.isEmpty()) {\n            roleSet.forEach(role -&amp;gt; authorities.add(new SimpleGrantedAuthority(role.getAuth())));\n        }\n        return authorities;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;code&gt;loadUserByUsername&lt;/code&gt;函数中的参数&lt;code&gt;s&lt;/code&gt;即为用户名，&lt;code&gt;userService.getCacheUser&lt;/code&gt;的作用是根据用户名获取用户，此处使用的自己写的从缓存获取用户名，可以自由发挥，只要能构建&lt;code&gt;UserDetails&lt;/code&gt;即可。&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;ol start=\&#34;3\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;filterinvocationsecuritymetadatasource\&#34;&gt;FilterInvocationSecurityMetadataSource&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  &lt;code&gt;FilterInvocationSecurityMetadataSource&lt;/code&gt;元数据，接口获取的是全部URL的权限信息和当http请求过来时候url对应的权限。其中&lt;code&gt;getAttributes&lt;/code&gt;的参数&lt;code&gt;o&lt;/code&gt;包含了当前访问的URL，根据URL我们需要返回对应的权限信息；&lt;code&gt;getAllConfigAttributes&lt;/code&gt;会在项目启动时执行一次，获取所有URL对应的权限信息。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport com.auth.frame.security.bean.Role;\nimport com.auth.frame.security.repository.RoleRepository;\nimport com.auth.frame.security.service.URLService;\nimport org.springframework.security.access.ConfigAttribute;\nimport org.springframework.security.access.SecurityConfig;\nimport org.springframework.security.web.FilterInvocation;\nimport org.springframework.security.web.access.intercept.FilterInvocationSecurityMetadataSource;\n\nimport java.util.Collection;\nimport java.util.HashSet;\nimport java.util.Set;\n\nimport static com.auth.frame.security.config.ConstValue.ROLE.DEFAULT_ROLE;\n\n/**\n * @ClassName CSTSecurityMetadataSource\n * @Author WFS\n * @Date 2020/1/21 17:06\n */\npublic class CSTSecurityMetadataSource implements FilterInvocationSecurityMetadataSource {\n\n    private URLService urlService;\n\n    private RoleRepository roleRepository;\n\n    public CSTSecurityMetadataSource(URLService urlService, RoleRepository roleRepository) {\n        this.urlService = urlService;\n        this.roleRepository = roleRepository;\n    }\n\n    @Override\n    public Collection&amp;lt;ConfigAttribute&amp;gt; getAttributes(Object o) throws IllegalArgumentException {\n        String url = ((FilterInvocation) o).getRequestUrl();\n        Collection&amp;lt;ConfigAttribute&amp;gt; configAttributes = new HashSet&amp;lt;&amp;gt;();\n        Set&amp;lt;Role&amp;gt; roles = urlService.getCacheURL(url);\n        roles.forEach(ele -&amp;gt; configAttributes.add(new SecurityConfig(ele.getAuth())));\n        if (configAttributes.isEmpty()) {\n            configAttributes.add(new SecurityConfig(DEFAULT_ROLE));\n        }\n        return configAttributes;\n    }\n\n    @Override\n    public Collection&amp;lt;ConfigAttribute&amp;gt; getAllConfigAttributes() {\n        Collection&amp;lt;ConfigAttribute&amp;gt; configAttributes = new HashSet&amp;lt;&amp;gt;();\n        roleRepository.findAllByDeletedIsFalse().forEach(e -&amp;gt; configAttributes.add(new SecurityConfig(e.getAuth())));\n        return configAttributes;\n    }\n\n    @Override\n    public boolean supports(Class&amp;lt;?&amp;gt; aClass) {\n        return true;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;ol start=\&#34;4\&#34;&gt;\n&lt;li&gt;\n&lt;h4 id=\&#34;accessdecisionmanager\&#34;&gt;AccessDecisionManager&lt;/h4&gt;\n&lt;/li&gt;\n&lt;/ol&gt;\n&lt;p&gt;  投票管理器，接口规定了用户权限和URL权限之间的逻辑，即满足某种情况拒绝或者允许。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport org.springframework.security.access.AccessDecisionManager;\nimport org.springframework.security.access.AccessDeniedException;\nimport org.springframework.security.access.ConfigAttribute;\nimport org.springframework.security.authentication.InsufficientAuthenticationException;\nimport org.springframework.security.core.Authentication;\n\nimport java.util.Collection;\n\nimport static com.auth.frame.security.config.ConstValue.ROLE.DEFAULT_ROLE;\n\n/**\n * @ClassName CSTAccessDecisionManager\n * @Author WFS\n * @Date 2020/1/21 17:06\n */\npublic class CSTAccessDecisionManager implements AccessDecisionManager {\n    @Override\n    public void decide(Authentication authentication, Object o, Collection&amp;lt;ConfigAttribute&amp;gt; collection) throws AccessDeniedException, InsufficientAuthenticationException {\n        if (collection.size() == 1 &amp;amp;&amp;amp; collection.stream().anyMatch(ele -&amp;gt; DEFAULT_ROLE.equals(ele.getAttribute()))) {\n            return;\n        }\n        if (!collection.stream().allMatch(ele -&amp;gt; authentication.getAuthorities().stream().anyMatch(e -&amp;gt; ele.getAttribute().equals(e.getAuthority())))) {\n            throw new AccessDeniedException(&amp;quot;AccessDenied!&amp;quot;);\n        }\n    }\n\n    @Override\n    public boolean supports(ConfigAttribute configAttribute) {\n        return Boolean.TRUE;\n    }\n\n    @Override\n    public boolean supports(Class&amp;lt;?&amp;gt; aClass) {\n        return Boolean.TRUE;\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;  &lt;code&gt;Authentication&lt;/code&gt;中包含有用户的权限信息，&lt;code&gt;Collection&amp;lt;ConfigAttribute&amp;gt;&lt;/code&gt;包含有当前URL需要的权限信息，根据这两个参数我们就可以自由的指定我们投票规则。比如：某个URL含有多个权限，某个用户只要拥有其中一个就可以访问，或者要求必须全部拥有对应的权限才可以访问，此处可以自由发挥。需要注意的是，&lt;strong&gt;&lt;code&gt;AccessDecisionManager&lt;/code&gt;不起作用的情况，原因是如果&lt;code&gt;Collection&amp;lt;ConfigAttribute&amp;gt;&lt;/code&gt;为&lt;code&gt;null&lt;/code&gt;或者&lt;code&gt;empty&lt;/code&gt;，则不会执行投票器，所以我们需要给没有配置权限的URL一个默认权限。&lt;/strong&gt;&lt;/p&gt;\n&lt;h2 id=\&#34;tokenfilter\&#34;&gt;tokenFilter&lt;/h2&gt;\n&lt;p&gt;  tokenFilter主要用来检查是否登陆的逻辑。先从请求里面获取token，解密，然后从reids里面获取相关权限信息；如果没有token则检查是否是用户名和密码，如果存在那么验证用户名和密码是否匹配，然后生成授权信息，存入redis，返回token给前端。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.processor;\n\nimport com.auth.frame.common.ResponseEntity;\nimport com.auth.frame.common.Utils.JSONUtil;\nimport com.auth.frame.common.Utils.StringUtil;\nimport com.auth.frame.security.Utils.TokenUtil;\nimport com.auth.frame.security.bean.User;\nimport com.auth.frame.security.repository.UserRepository;\nimport org.springframework.data.redis.core.RedisTemplate;\nimport org.springframework.security.authentication.UsernamePasswordAuthenticationToken;\nimport org.springframework.security.core.context.SecurityContextHolder;\nimport org.springframework.stereotype.Component;\nimport org.springframework.util.DigestUtils;\n\nimport javax.annotation.Resource;\nimport javax.servlet.*;\nimport javax.servlet.http.HttpServletRequest;\nimport javax.servlet.http.HttpServletResponse;\nimport java.io.IOException;\nimport java.nio.charset.StandardCharsets;\nimport java.util.Set;\nimport java.util.UUID;\nimport java.util.concurrent.TimeUnit;\n\n/**\n * @ClassName TokenFilter\n * @Author WFS\n * @Date 2020/1/21 10:47\n */\n@Component\npublic class TokenFilter implements Filter {\n\n\n    private final UserRepository userRepository;\n\n    @Resource(name = &amp;quot;sysTokenRedisTemplate&amp;quot;)\n    public RedisTemplate&amp;lt;String, String&amp;gt; redisTemplate;\n\n    private static final String usernameParameter = &amp;quot;username&amp;quot;;\n    private static final String passwordParameter = &amp;quot;password&amp;quot;;\n\n    public TokenFilter(UserRepository userRepository) {\n        this.userRepository = userRepository;\n    }\n\n    @Override\n    public void init(FilterConfig filterConfig) {\n\n    }\n\n    @Override\n    public void destroy() {\n\n    }\n\n    @Override\n    public void doFilter(ServletRequest servletRequest, ServletResponse servletResponse, FilterChain filterChain) throws IOException, ServletException {\n        HttpServletRequest request = (HttpServletRequest) servletRequest;\n        HttpServletResponse response = (HttpServletResponse) servletResponse;\n        String rds = TokenUtil.getBody(request);\n        if (rds == null) {\n            String username = request.getParameter(usernameParameter);\n            String password = request.getParameter(passwordParameter);\n            if (!StringUtil.isNullOrEmpty(username, password)) {\n                User user = userRepository.findByDeletedIsFalseAndUserName(username);\n                if (user != null) {\n                    if (user.getAccountNonExpired() &amp;amp;&amp;amp; user.getAccountNonLocked() &amp;amp;&amp;amp; user.getCredentialsNonExpired() &amp;amp;&amp;amp; user.getEnabled()) {\n                        if (!StringUtil.isNullOrEmpty(user.getSalt(), user.getPassWord())) {\n                            if (user.getPassWord().equals(DigestUtils.md5DigestAsHex((password + user.getSalt()).getBytes(StandardCharsets.UTF_8)))) {\n                                Set&amp;lt;String&amp;gt; rdsSet = redisTemplate.keys(&amp;quot;*&amp;quot;);\n                                if (rdsSet != null) {\n                                    for (String s : rdsSet) {\n                                        String rc = redisTemplate.opsForValue().get(s);\n                                        if (rc != null) {\n                                            CSTUserDetails rc_u = JSONUtil.json2Obj(rc, CSTUserDetails.class);\n                                            if (rc_u != null) {\n                                                if (user.getId().equals(rc_u.getUserId())) {\n                                                    redisTemplate.delete(s);\n                                                }\n                                            }\n                                        }\n                                    }\n                                }\n                                CSTUserDetails cstUserDetails = new CSTUserDetails(user);\n                                String r = UUID.randomUUID().toString().replaceAll(&amp;quot;-&amp;quot;, &amp;quot;&amp;quot;);\n                                redisTemplate.opsForValue().set(r, JSONUtil.obj2Json(cstUserDetails));\n                                redisTemplate.expire(r, 2, TimeUnit.HOURS);\n                                String token = TokenUtil.create(r);\n                                ResponseEntity.ofToken(response, token);\n                                return;\n                            }\n                        }\n                    }\n                }\n            }\n        } else {\n            String cuStr = redisTemplate.opsForValue().get(rds);\n            if (!StringUtil.isNullOrEmpty(cuStr)) {\n                CSTUserDetails cu = JSONUtil.json2Obj(cuStr, CSTUserDetails.class);\n                if (cu != null) {\n                    if (cu.getAccountNonExpired() &amp;amp;&amp;amp; cu.getAccountNonLocked() &amp;amp;&amp;amp; cu.getCredentialsNonExpired() &amp;amp;&amp;amp; cu.getEnabled()) {\n                        SecurityContextHolder.getContext().setAuthentication(new UsernamePasswordAuthenticationToken(cu.getUserId(), cu.getPassword(), cu.getAuthorities()));\n                    }\n                }\n            }\n        }\n        filterChain.doFilter(servletRequest, servletResponse);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;ol&gt;\n&lt;li&gt;&lt;code&gt;TokenUtil&lt;/code&gt; 主要从&lt;code&gt;request&lt;/code&gt;里面解析&lt;code&gt;token&lt;/code&gt;里面的&lt;code&gt;rds&lt;/code&gt;&lt;/li&gt;\n&lt;li&gt;中间有一段&lt;code&gt;redis&lt;/code&gt;的操作，此处可以自行拓展，即每一个新的附带密码的请求都去删除&lt;code&gt;redis&lt;/code&gt;里面相同&lt;code&gt;userId&lt;/code&gt;的授权信息，这样做的好处是可以保证每个账号同一个时间只有一个人登陆。&lt;/li&gt;\n&lt;li&gt;&lt;code&gt;ResponseEntity.ofToken()&lt;/code&gt; 工具类，用于向&lt;code&gt;response&lt;/code&gt;返回信息&lt;/li&gt;\n&lt;/ol&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;配置spring-security\&#34;&gt;配置&lt;code&gt;spring security&lt;/code&gt;&lt;/h2&gt;\n&lt;p&gt;  设置&lt;code&gt;withObjectPostProcessor&lt;/code&gt;来设置&lt;code&gt;AccessDecisionManager&lt;/code&gt;和&lt;code&gt;SecurityMetadataSource&lt;/code&gt;，&lt;code&gt;addFilterBefore&lt;/code&gt;设置&lt;code&gt;TokenFilter&lt;/code&gt;的位置，&lt;code&gt;web.ignoring&lt;/code&gt;设置开放&lt;code&gt;API&lt;/code&gt;的路径，开放&lt;code&gt;API&lt;/code&gt;不受&lt;code&gt;spring security&lt;/code&gt;过滤链的控制。&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;package com.auth.frame.security.config;\n\nimport com.auth.frame.security.processor.CSTAccessDecisionManager;\nimport com.auth.frame.security.processor.CSTSecurityMetadataSource;\nimport com.auth.frame.security.processor.CSTUserDetailsService;\nimport com.auth.frame.security.processor.TokenFilter;\nimport com.auth.frame.security.repository.RoleRepository;\nimport com.auth.frame.security.service.URLService;\nimport org.springframework.context.annotation.Bean;\nimport org.springframework.context.annotation.Configuration;\nimport org.springframework.security.config.annotation.ObjectPostProcessor;\nimport org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;\nimport org.springframework.security.config.annotation.method.configuration.EnableGlobalMethodSecurity;\nimport org.springframework.security.config.annotation.web.builders.HttpSecurity;\nimport org.springframework.security.config.annotation.web.builders.WebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;\nimport org.springframework.security.config.annotation.web.configuration.WebSecurityConfigurerAdapter;\nimport org.springframework.security.config.http.SessionCreationPolicy;\nimport org.springframework.security.web.access.intercept.FilterSecurityInterceptor;\nimport org.springframework.security.web.authentication.UsernamePasswordAuthenticationFilter;\nimport org.springframework.web.cors.CorsUtils;\n\n/**\n * @ClassName SecurityConfig\n * @Author WFS\n * @Date 2020/1/21 10:25\n */\n@Configuration\n@EnableWebSecurity\n@EnableGlobalMethodSecurity(jsr250Enabled = true)\npublic class SecurityConfig extends WebSecurityConfigurerAdapter {\n\n\n    private final CSTUserDetailsService cstUserDetailsService;\n    private final ApplicationSecurityConfig applicationSecurityConfig;\n    private final TokenFilter tokenFilter;\n\n    private final URLService urlService;\n    private final RoleRepository roleRepository;\n\n\n    public SecurityConfig(CSTUserDetailsService cstUserDetailsService, ApplicationSecurityConfig applicationSecurityConfig, TokenFilter tokenFilter, URLService urlService, RoleRepository roleRepository) {\n        this.cstUserDetailsService = cstUserDetailsService;\n        this.applicationSecurityConfig = applicationSecurityConfig;\n        this.tokenFilter = tokenFilter;\n        this.urlService = urlService;\n        this.roleRepository = roleRepository;\n    }\n\n    @Override\n    protected void configure(AuthenticationManagerBuilder auth) throws Exception {\n        auth.userDetailsService(cstUserDetailsService);\n    }\n\n    @Bean\n    public CSTAccessDecisionManager getCSTAccessDecisionManager() {\n        return new CSTAccessDecisionManager();\n    }\n\n    @Bean\n    public CSTSecurityMetadataSource getCSTSecurityMetadataSource() {\n        return new CSTSecurityMetadataSource(urlService, roleRepository);\n    }\n\n    @Override\n    protected void configure(HttpSecurity http) throws Exception {\n        http.csrf().disable().cors()\n                .and().authorizeRequests()\n                .withObjectPostProcessor(new ObjectPostProcessor&amp;lt;FilterSecurityInterceptor&amp;gt;() {\n                    @Override\n                    public &amp;lt;O extends FilterSecurityInterceptor&amp;gt; O postProcess(O o) {\n                        o.setAccessDecisionManager(getCSTAccessDecisionManager());\n                        o.setSecurityMetadataSource(getCSTSecurityMetadataSource());\n                        return o;\n                    }\n                })\n                .requestMatchers(CorsUtils::isPreFlightRequest).permitAll()\n                .anyRequest().authenticated()\n                .and().anonymous().disable().formLogin().permitAll()\n                .and().addFilterBefore(tokenFilter, UsernamePasswordAuthenticationFilter.class)\n                .sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);\n    }\n\n    @Override\n    public void configure(WebSecurity web) {\n        web.ignoring().regexMatchers(applicationSecurityConfig.getOpenApi());\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;结语\&#34;&gt;结语&lt;/h2&gt;\n&lt;p&gt;  通过以上逻辑，token登陆和自定义权限功能已经完成，其实所有的功能实现集中于&lt;code&gt;UserDetails&lt;/code&gt;的构建和&lt;code&gt;AccessDecisionManager&lt;/code&gt;投票逻辑，熟知于此就可以随意拓展Filter来实现自己的功能。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;springSecurityTokenLogin&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;Spring Security 自定义权限实现 redis token 登陆验证&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;spring security&#34;,&#34;slug&#34;:&#34;springSecurity&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/springSecurity/&#34;},{&#34;index&#34;:2,&#34;name&#34;:&#34;spring boot&#34;,&#34;slug&#34;:&#34;spring boot&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/spring boot/&#34;},{&#34;index&#34;:-1,&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;Java&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/Java/&#34;}],&#34;date&#34;:&#34;2020-12-30 17:45:32&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/springSecurityTokenLogin/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;20 min read&#34;,&#34;time&#34;:1151000,&#34;words&#34;:3619,&#34;minutes&#34;:20},&#34;description&#34;:&#34;前言\n  本文的实现方式主要针于与对spring security有所了解的读者，通过增加filter的方式，替换代替spring security自带的的能登陆逻辑。\n准备工作\npom 配置\n    &amp;lt;parent&amp;gt;\n    ...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%89%8D%E8%A8%80\&#34;&gt;前言&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C\&#34;&gt;准备工作&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#pom-%E9%85%8D%E7%BD%AE\&#34;&gt;pom 配置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#redis-%E9%85%8D%E7%BD%AE\&#34;&gt;redis 配置&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%B7%A8%E5%9F%9F%E9%85%8D%E7%BD%AE\&#34;&gt;跨域配置&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8E%9F%E7%90%86\&#34;&gt;原理&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#token-%E7%99%BB%E9%99%86\&#34;&gt;token 登陆&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%87%AA%E5%AE%9A%E4%B9%89%E7%94%A8%E6%88%B7%E6%9D%83%E9%99%90\&#34;&gt;自定义用户权限&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF%E8%A1%A8\&#34;&gt;用户信息表&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%94%A8%E6%88%B7%E8%A1%A8\&#34;&gt;用户表&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%A7%92%E8%89%B2%E8%A1%A8\&#34;&gt;角色表&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#url%E8%A1%A8\&#34;&gt;URL表&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%87%AA%E5%AE%9A%E4%B9%89%E8%AE%A4%E8%AF%81\&#34;&gt;自定义认证&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#userdetails\&#34;&gt;UserDetails&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#userdetailsservice\&#34;&gt;UserDetailsService&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#filterinvocationsecuritymetadatasource\&#34;&gt;FilterInvocationSecurityMetadataSource&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#accessdecisionmanager\&#34;&gt;AccessDecisionManager&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#tokenfilter\&#34;&gt;tokenFilter&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E9%85%8D%E7%BD%AEspring-security\&#34;&gt;配置&lt;code&gt;spring security&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%BB%93%E8%AF%AD\&#34;&gt;结语&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;p&gt;事实上VBA的启用依赖于运行的容器，VBA本身没有强制启用的功能。但是我们可以用另外一种方法来实现 强制启用的功能：如果不启用那么，显示一个页面，提示启用；如果启用就隐藏提示，显示正文。&lt;br&gt;\n大概代码如下：&lt;/p&gt;\n&lt;pre&gt;&lt;code&gt;Private Sub Workbook_BeforeClose(Cancel As Boolean)\n    Dim sh AsWorksheet\n    ForEach sht In Worksheets\n        If sht.Name&amp;lt;&amp;gt;”Welcome”Then\n           Sheets(sht.Name).Visible= False\n        End If\n    Next\n    Sheets(“Welcome”).Visible= True\n    Sheets(“Welcome”).Select\n    ThisWorkbook.Save\nEnd Sub\nPrivate Sub Workbook_Open()\n    Dim sht AsWorksheet\n    ForEach sht In Worksheets\n        If sht.Name&amp;lt;&amp;gt;”Welcome” Then\n            sht.Visible = xlSheetVisible\n        End If\n    Next\n    Worksheets(“Welcome”).Visible= xlSheetVeryHidden\n    ThisWorkbook.Save\nEnd Sub\n&lt;/code&gt;&lt;/pre&gt;\n&lt;p&gt;代码很好理解：关闭之前，隐藏所有sheet，只显示Welcome；打开文件隐藏Welcome，显示正文。&lt;/p&gt;\n&#34;,&#34;fileName&#34;:&#34;excelForceEnableVba&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;excel强制启用VBA&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;excel&#34;,&#34;slug&#34;:&#34;excel&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/excel/&#34;},{&#34;index&#34;:-1,&#34;name&#34;:&#34;vba&#34;,&#34;slug&#34;:&#34;vba&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/vba/&#34;}],&#34;date&#34;:&#34;2020-12-30 17:28:22&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/excelForceEnableVba/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:50000,&#34;words&#34;:186,&#34;minutes&#34;:1},&#34;description&#34;:&#34;事实上VBA的启用依赖于运行的容器，VBA本身没有强制启用的功能。但是我们可以用另外一种方法来实现 强制启用的功能：如果不启用那么，显示一个页面，提示启用；如果启用就隐藏提示，显示正文。\n大概代码如下：\nPrivate Sub Workbo...&#34;,&#34;toc&#34;:&#34;&#34;},{&#34;content&#34;:&#34;&lt;h2 id=\&#34;修改pom文件\&#34;&gt;修改pom文件&lt;/h2&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;\n\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;\n    &amp;lt;!-- 移除嵌入式tomcat插件 --&amp;gt;\n    &amp;lt;exclusions&amp;gt;\n        &amp;lt;exclusion&amp;gt;\n            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;\n            &amp;lt;artifactId&amp;gt;spring-boot-starter-tomcat&amp;lt;/artifactId&amp;gt;\n        &amp;lt;/exclusion&amp;gt;\n    &amp;lt;/exclusions&amp;gt;\n&amp;lt;/dependency&amp;gt;\n\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;javax.servlet&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;javax.servlet-api&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;4.0.1&amp;lt;/version&amp;gt;\n    &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;修改application启动类\&#34;&gt;修改Application启动类&lt;/h2&gt;\n&lt;h4 id=\&#34;修改前\&#34;&gt;修改前&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;public class Application {\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;修改后\&#34;&gt;修改后&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;public class Application extends SpringBootServletInitializer {\n\n    @Override\n    protected SpringApplicationBuilder configure(SpringApplicationBuilder builder) {\n        return builder.sources(Application.class);\n    }\n    public static void main(String[] args) {\n        SpringApplication.run(Application.class, args);\n    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h2 id=\&#34;特别注意\&#34;&gt;特别注意&lt;/h2&gt;\n&lt;h4 id=\&#34;如果使用了-websocket那么需要注释掉下面的代码同时添加websocket的支持\&#34;&gt;如果使用了 &lt;code&gt;websocket&lt;/code&gt;，那么需要注释掉下面的代码，同时添加&lt;code&gt;websocket&lt;/code&gt;的支持。&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;@Configuration\npublic class WebSocketConfig {\n//    @Bean\n//    public ServerEndpointExporter serverEndpointExporter() {\n//        return new ServerEndpointExporter();\n//    }\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;!-- https://mvnrepository.com/artifact/javax.websocket/javax.websocket-api --&amp;gt;\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;javax.websocket&amp;lt;/groupId&amp;gt;\n    &amp;lt;artifactId&amp;gt;javax.websocket-api&amp;lt;/artifactId&amp;gt;\n    &amp;lt;version&amp;gt;1.1&amp;lt;/version&amp;gt;\n    &amp;lt;scope&amp;gt;provided&amp;lt;/scope&amp;gt;\n&amp;lt;/dependency&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;如果使用了注解webfilter那么需要使用filterregistrationbean的方式来注册filter\&#34;&gt;如果使用了注解&lt;code&gt;@WebFilter&lt;/code&gt;，那么需要使用&lt;code&gt;FilterRegistrationBean&lt;/code&gt;的方式来注册&lt;code&gt;Filter&lt;/code&gt;。&lt;/h4&gt;\n&#34;,&#34;fileName&#34;:&#34;springbootPackageToWar&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;spring boot 打包为外置 tomcat (war)&#34;,&#34;tags&#34;:[{&#34;index&#34;:2,&#34;name&#34;:&#34;spring boot&#34;,&#34;slug&#34;:&#34;spring boot&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/spring boot/&#34;},{&#34;index&#34;:-1,&#34;name&#34;:&#34;maven&#34;,&#34;slug&#34;:&#34;maven&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/maven/&#34;},{&#34;index&#34;:-1,&#34;name&#34;:&#34;tomcat&#34;,&#34;slug&#34;:&#34;tomcat&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/tomcat/&#34;}],&#34;date&#34;:&#34;2020-12-30 16:43:23&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/springbootPackageToWar/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;2 min read&#34;,&#34;time&#34;:93000,&#34;words&#34;:281,&#34;minutes&#34;:2},&#34;description&#34;:&#34;修改pom文件\n&amp;lt;packaging&amp;gt;war&amp;lt;/packaging&amp;gt;\n\n&amp;lt;dependency&amp;gt;\n    &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/group...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9pom%E6%96%87%E4%BB%B6\&#34;&gt;修改pom文件&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9application%E5%90%AF%E5%8A%A8%E7%B1%BB\&#34;&gt;修改Application启动类&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9%E5%89%8D\&#34;&gt;修改前&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E4%BF%AE%E6%94%B9%E5%90%8E\&#34;&gt;修改后&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E7%89%B9%E5%88%AB%E6%B3%A8%E6%84%8F\&#34;&gt;特别注意&lt;/a&gt;&lt;br&gt;\n*\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E4%BA%86-websocket%E9%82%A3%E4%B9%88%E9%9C%80%E8%A6%81%E6%B3%A8%E9%87%8A%E6%8E%89%E4%B8%8B%E9%9D%A2%E7%9A%84%E4%BB%A3%E7%A0%81%E5%90%8C%E6%97%B6%E6%B7%BB%E5%8A%A0websocket%E7%9A%84%E6%94%AF%E6%8C%81\&#34;&gt;如果使用了 &lt;code&gt;websocket&lt;/code&gt;，那么需要注释掉下面的代码，同时添加&lt;code&gt;websocket&lt;/code&gt;的支持。&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%A6%82%E6%9E%9C%E4%BD%BF%E7%94%A8%E4%BA%86%E6%B3%A8%E8%A7%A3webfilter%E9%82%A3%E4%B9%88%E9%9C%80%E8%A6%81%E4%BD%BF%E7%94%A8filterregistrationbean%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9D%A5%E6%B3%A8%E5%86%8Cfilter\&#34;&gt;如果使用了注解&lt;code&gt;@WebFilter&lt;/code&gt;，那么需要使用&lt;code&gt;FilterRegistrationBean&lt;/code&gt;的方式来注册&lt;code&gt;Filter&lt;/code&gt;。&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h4 id=\&#34;catalina-设置-java-参数\&#34;&gt;catalina 设置 java 参数&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;set CATALINA_OPTS=-Dfile.encoding=UTF-8 -server -Xms8192m -Xmx8192m -Xmn4096m -XX:SurvivorRatio=10 -XX:MaxTenuringThreshold=15 -XX:NewRatio=2 -XX:+DisableExplicitGC\n&lt;/code&gt;&lt;/pre&gt;\n&lt;blockquote&gt;\n&lt;p&gt;根据环境的配置优化相关参数&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h4 id=\&#34;serverxml-设置连接池\&#34;&gt;Server.xml 设置连接池&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;    &amp;lt;Executor \n       name=&amp;quot;tomcatThreadPool&amp;quot; \n       namePrefix=&amp;quot;catalina-exec-&amp;quot;\n       maxThreads=&amp;quot;500&amp;quot; \n       minSpareThreads=&amp;quot;100&amp;quot; \n       prestartminSpareThreads = &amp;quot;true&amp;quot;\n       maxQueueSize = &amp;quot;100&amp;quot;\n    /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;开启压缩和-nio2\&#34;&gt;开启压缩和 NIO2&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;  &amp;lt;Connector \n    \texecutor=&amp;quot;tomcatThreadPool&amp;quot;\n   \tport=&amp;quot;80&amp;quot; \n   \tprotocol=&amp;quot;org.apache.coyote.http11.Http11Nio2Protocol&amp;quot; \n   \tconnectionTimeout=&amp;quot;20000&amp;quot; \n   \tmaxConnections=&amp;quot;10000&amp;quot; \n   \tredirectPort=&amp;quot;8443&amp;quot; \n   \tenableLookups=&amp;quot;false&amp;quot; \n   \tacceptCount=&amp;quot;100&amp;quot; \n   \tmaxPostSize=&amp;quot;10485760&amp;quot; \n   \tcompression=&amp;quot;on&amp;quot; \n   \tdisableUploadTimeout=&amp;quot;true&amp;quot; \n   \tcompressionMinSize=&amp;quot;50&amp;quot; \n   \tacceptorThreadCount=&amp;quot;4&amp;quot; \n   \tcompressableMimeType=&amp;quot;text/html,text/xml,text/plain,text/css,text/javascript,application/javascript,application/x-javascript,application/json,image/jpg,application/x-font-ttf,application/x-font-otf,image/svg+xml,image/jpeg,image/png,image/gif,audio/mpeg,video/mp4,font/woff&amp;quot; \n   \tURIEncoding=&amp;quot;utf-8&amp;quot;\n     /&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;webxml-设置缓存\&#34;&gt;web.xml 设置缓存&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;&amp;lt;filter&amp;gt;\n &amp;lt;filter-name&amp;gt;ExpiresFilter&amp;lt;/filter-name&amp;gt;\n &amp;lt;filter-class&amp;gt;org.apache.catalina.filters.ExpiresFilter&amp;lt;/filter-class&amp;gt;\n &amp;lt;init-param&amp;gt;\n    &amp;lt;param-name&amp;gt;ExpiresByType image&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;\n &amp;lt;/init-param&amp;gt;\n &amp;lt;init-param&amp;gt;\n    &amp;lt;param-name&amp;gt;ExpiresByType text&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;\n &amp;lt;/init-param&amp;gt;\n &amp;lt;init-param&amp;gt;\n    &amp;lt;param-name&amp;gt;ExpiresByType application/javascript&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;\n &amp;lt;/init-param&amp;gt;\n &amp;lt;init-param&amp;gt;\n    &amp;lt;param-name&amp;gt;ExpiresByType multipart/form-data&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;\n &amp;lt;/init-param&amp;gt;\n &amp;lt;init-param&amp;gt;\n    &amp;lt;param-name&amp;gt;ExpiresByType font/woff&amp;lt;/param-name&amp;gt;\n    &amp;lt;param-value&amp;gt;access plus 30 days&amp;lt;/param-value&amp;gt;\n &amp;lt;/init-param&amp;gt;\n&amp;lt;/filter&amp;gt;\n\n&amp;lt;filter-mapping&amp;gt;\n &amp;lt;filter-name&amp;gt;ExpiresFilter&amp;lt;/filter-name&amp;gt;\n &amp;lt;url-pattern&amp;gt;/*&amp;lt;/url-pattern&amp;gt;\n &amp;lt;dispatcher&amp;gt;REQUEST&amp;lt;/dispatcher&amp;gt;\n&amp;lt;/filter-mapping&amp;gt;\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;tomcatOptimizationAndCache&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;tomcat 常用的优化&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;tomcat&#34;,&#34;slug&#34;:&#34;tomcat&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/tomcat/&#34;}],&#34;date&#34;:&#34;2020-12-30 16:39:26&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/tomcatOptimizationAndCache/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:148000,&#34;words&#34;:410,&#34;minutes&#34;:3},&#34;description&#34;:&#34;catalina 设置 java 参数\nset CATALINA_OPTS=-Dfile.encoding=UTF-8 -server -Xms8192m -Xmx8192m -Xmn4096m -XX:SurvivorRatio=10 -...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#catalina-%E8%AE%BE%E7%BD%AE-java-%E5%8F%82%E6%95%B0\&#34;&gt;catalina 设置 java 参数&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#serverxml-%E8%AE%BE%E7%BD%AE%E8%BF%9E%E6%8E%A5%E6%B1%A0\&#34;&gt;Server.xml 设置连接池&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%BC%80%E5%90%AF%E5%8E%8B%E7%BC%A9%E5%92%8C-nio2\&#34;&gt;开启压缩和 NIO2&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#webxml-%E8%AE%BE%E7%BD%AE%E7%BC%93%E5%AD%98\&#34;&gt;web.xml 设置缓存&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;blockquote&gt;\n&lt;p&gt;欢迎来到我的Github Pages呀，很高兴遇见你！🤝&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;博主是谁\&#34;&gt;👨‍💻 博主是谁&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;一个快奔三的Java 后端工程师&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;兴趣爱好\&#34;&gt;⛹ 兴趣爱好&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;代码算不算？╮(╯▽╰)╭&lt;/p&gt;\n&lt;/blockquote&gt;\n&lt;h2 id=\&#34;联系我呀\&#34;&gt;📬 联系我呀&lt;/h2&gt;\n&lt;blockquote&gt;\n&lt;p&gt;&lt;a href=\&#34;https://github.com/FikaCode\&#34;&gt;https://github.com/FikaCode&lt;/a&gt;&lt;/p&gt;\n&lt;/blockquote&gt;\n&#34;,&#34;fileName&#34;:&#34;about&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;关于&#34;,&#34;tags&#34;:[],&#34;date&#34;:&#34;2020-12-30 12:00:35&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/about/&#34;,&#34;hideInList&#34;:true,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;1 min read&#34;,&#34;time&#34;:10000,&#34;words&#34;:48,&#34;minutes&#34;:1},&#34;description&#34;:&#34;\n欢迎来到我的Github Pages呀，很高兴遇见你！🤝\n\n👨‍💻 博主是谁\n\n一个快奔三的Java 后端工程师\n\n⛹ 兴趣爱好\n\n代码算不算？╮(╯▽╰)╭\n\n📬 联系我呀\n\nhttps://github.com/FikaCod...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%8D%9A%E4%B8%BB%E6%98%AF%E8%B0%81\&#34;&gt;👨‍💻 博主是谁&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%85%B4%E8%B6%A3%E7%88%B1%E5%A5%BD\&#34;&gt;⛹ 兴趣爱好&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E8%81%94%E7%B3%BB%E6%88%91%E5%91%80\&#34;&gt;📬 联系我呀&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;},{&#34;content&#34;:&#34;&lt;h4 id=\&#34;将一组数据平均分成n组\&#34;&gt;将一组数据平均分成n组&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/**\n * 将一组数据平均分成n组\n *\n * @param source 要分组的数据源\n * @param n      平均分成n组\n * @param &amp;lt;T&amp;gt;\n * @return\n */\npublic static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; averageAssign(List&amp;lt;T&amp;gt; source, int n) {\n    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();\n    int remainder = source.size() % n;  //(先计算出余数)\n    int number = source.size() / n;  //然后是商\n    int offset = 0;//偏移量\n    for (int i = 0; i &amp;lt; n; i++) {\n        List&amp;lt;T&amp;gt; value = null;\n        if (remainder &amp;gt; 0) {\n            value = source.subList(i * number + offset, (i + 1) * number + offset + 1);\n            remainder--;\n            offset++;\n        } else {\n            value = source.subList(i * number + offset, (i + 1) * number + offset);\n        }\n        result.add(value);\n    }\n    return result;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;将一组数据固定分组每组n个元素\&#34;&gt;将一组数据固定分组，每组n个元素&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/**\n * 将一组数据固定分组，每组n个元素\n * @param source 要分组的数据源\n * @param n      每组n个元素\n * @param &amp;lt;T&amp;gt;\n * @return\n */\npublic static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; fixedGrouping(List&amp;lt;T&amp;gt; source, int n) {\n\n    if (null == source || source.size() == 0 || n &amp;lt;= 0)\n        return null;\n    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();\n\n    int sourceSize = source.size();\n    int size = (source.size() / n) + 1;\n    for (int i = 0; i &amp;lt; size; i++) {\n        List&amp;lt;T&amp;gt; subset = new ArrayList&amp;lt;T&amp;gt;();\n        for (int j = i * n; j &amp;lt; (i + 1) * n; j++) {\n            if (j &amp;lt; sourceSize) {\n                subset.add(source.get(j));\n            }\n        }\n        result.add(subset);\n    }\n    return result;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&lt;h4 id=\&#34;将一组数据固定分组每组n个元素-2\&#34;&gt;将一组数据固定分组，每组n个元素&lt;/h4&gt;\n&lt;pre&gt;&lt;code&gt;/**\n * 将一组数据固定分组，每组n个元素，第二种写法\n *\n * @param source 要分组的数据源\n * @param n      每组n个元素\n * @param &amp;lt;T&amp;gt;\n * @return\n */\npublic static &amp;lt;T&amp;gt; List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; fixedGrouping2(List&amp;lt;T&amp;gt; source, int n) {\n\n    if (null == source || source.size() == 0 || n &amp;lt;= 0)\n        return null;\n    List&amp;lt;List&amp;lt;T&amp;gt;&amp;gt; result = new ArrayList&amp;lt;List&amp;lt;T&amp;gt;&amp;gt;();\n    int remainder = source.size() % n;\n    int size = (source.size() / n);\n    for (int i = 0; i &amp;lt; size; i++) {\n        List&amp;lt;T&amp;gt; subset = null;\n        subset = source.subList(i * n, (i + 1) * n);\n        result.add(subset);\n    }\n    if (remainder &amp;gt; 0) {\n        List&amp;lt;T&amp;gt; subset = null;\n        subset = source.subList(size * n, size * n + remainder);\n        result.add(subset);\n    }\n    return result;\n}\n&lt;/code&gt;&lt;/pre&gt;\n&#34;,&#34;fileName&#34;:&#34;javaListAverage&#34;,&#34;abstract&#34;:&#34;&#34;,&#34;title&#34;:&#34;java 将数组均分为多个数组&#34;,&#34;tags&#34;:[{&#34;index&#34;:-1,&#34;name&#34;:&#34;Java&#34;,&#34;slug&#34;:&#34;Java&#34;,&#34;used&#34;:true,&#34;link&#34;:&#34;https://fikacode.github.io/tag/Java/&#34;}],&#34;date&#34;:&#34;2020-12-30 11:25:57&#34;,&#34;dateFormat&#34;:&#34;2020-12-30&#34;,&#34;feature&#34;:&#34;&#34;,&#34;link&#34;:&#34;https://fikacode.github.io/post/javaListAverage/&#34;,&#34;hideInList&#34;:false,&#34;isTop&#34;:false,&#34;stats&#34;:{&#34;text&#34;:&#34;3 min read&#34;,&#34;time&#34;:152000,&#34;words&#34;:467,&#34;minutes&#34;:3},&#34;description&#34;:&#34;将一组数据平均分成n组\n/**\n * 将一组数据平均分成n组\n *\n * @param source 要分组的数据源\n * @param n      平均分成n组\n * @param &amp;lt;T&amp;gt;\n * @return\n */\npu...&#34;,&#34;toc&#34;:&#34;&lt;ul class=\&#34;markdownIt-TOC\&#34;&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;\n&lt;ul&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B0%86%E4%B8%80%E7%BB%84%E6%95%B0%E6%8D%AE%E5%B9%B3%E5%9D%87%E5%88%86%E6%88%90n%E7%BB%84\&#34;&gt;将一组数据平均分成n组&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B0%86%E4%B8%80%E7%BB%84%E6%95%B0%E6%8D%AE%E5%9B%BA%E5%AE%9A%E5%88%86%E7%BB%84%E6%AF%8F%E7%BB%84n%E4%B8%AA%E5%85%83%E7%B4%A0\&#34;&gt;将一组数据固定分组，每组n个元素&lt;/a&gt;&lt;/li&gt;\n&lt;li&gt;&lt;a href=\&#34;#%E5%B0%86%E4%B8%80%E7%BB%84%E6%95%B0%E6%8D%AE%E5%9B%BA%E5%AE%9A%E5%88%86%E7%BB%84%E6%AF%8F%E7%BB%84n%E4%B8%AA%E5%85%83%E7%B4%A0-2\&#34;&gt;将一组数据固定分组，每组n个元素&lt;/a&gt;&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&lt;/li&gt;\n&lt;/ul&gt;\n&#34;}]";
  // var json = escape.substr(1, escape.length - 2);
  // var datas = json.split(',');
  // for (let i=0; i < datas.length; i++) {
  //   let item = datas[i];
  //   let attrs = item.split('34;:&#34')
  //   debugger
  //   console.log(datas[i])
  // }
  let escapeMap = new Map();
  escapeMap.set('&#34;', '"');
  escapeMap.set('&gt;', '>');
  escapeMap.set('&#39;', "'");
  escapeMap.set('&lt;', '<');
  escapeMap.set('&quot;', '"');
  escapeMap.set('&amp;', '&');
</script> -->



</html>